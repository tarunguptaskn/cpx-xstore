define(["jquery","jraf/jrafcore","ojs/ojcore","knockout","jraf/utils/ValidationUtils","ojs/ojtoolbar","ojs/ojbutton","ojs/ojoffcanvas","ojs/ojknockout"],(function(t,e,n,i,o){"use strict";var r=n.Translations.getTranslatedString;function s(t){if(!o.isObjectStrict(t)||!o.isNonemptyString(t.title)&&!o.isObjectStrict(t.headerModule)||!o.isObjectStrict(t.mainContent))throw new TypeError("ContentFrame: Missing required properties");this.tv=t.jraf,this.mainContentId=e.UIShell.generateUniqueId(),this.contentFrameDrawerId=e.UIShell.generateUniqueId(),this.headerTitle=r(t.title),this.headerModule=this.iv(t.headerModule),this.mainContentModule=this.iv(t.mainContent),this.xi=[],this.activePanelModuleBinding=i.observable(),this.panelLoading=i.observable(!1),this.panelOpen=i.observable(!1);var s=n.ResponsiveKnockoutUtils.createScreenRangeObservable();this.isSmallScreen=i.pureComputed((function(){return s()===n.ResponsiveUtils.SCREEN_RANGE.SM})),this.showModalOverlay=i.pureComputed((function(){return this.panelOpen()&&this.isSmallScreen()}),this),this.compactMainContent=i.pureComputed((function(){return this.panelOpen()&&!this.isSmallScreen()}),this),this.Si(t),this.Bi()}return s.prototype.iv=function(e){return o.isObjectStrict(e)?t.extend(!0,{},e,{params:{jraf:this.tv}}):e},s.prototype.Si=function(t){var n=[];if(o.isObjectStrict(t.helpContent)){var s=e.UIShell.generateUniqueId();n.push({label:r("jraf.appframe.help"),icon:"jraf-help-icon",id:s,module:{name:"jraf/contentframe/ContentPanel",cacheKey:s,params:{title:r("jraf.appframe.help"),content:this.iv(t.helpContent)}}})}this.nv={};for(var l=0;l<n.length;l++){var a=n[l];this.nv[a.id]=a,this.sv(a.module),this.rv(a.module)}this.defaultPanels=i.observableArray(n),this.hasPanels=i.pureComputed((function(){return 0<this.defaultPanels().length}),this),this.zi=Promise.resolve()},s.prototype.Bi=function(){this.selectedToolbarButtons=i.observableArray([]);var t=null;this.selectedToolbarButtons.subscribe((function(e){t=e}),null,"beforeChange"),this.selectedToolbarButtons.subscribe((function(e){this.Ei(t,e)}),this)},s.prototype.Ei=function(t,e){if(0!==e.length){var n=e[0];1<e.length&&e.map((function(e){t.indexOf(e)<0&&(n=e)})),this.Li(n),this.panelOpen()||this.Mi()}else this.Ci()},s.prototype.Li=function(t){var e=this.nv[t];e&&this.activePanelModuleBinding(e.module)},s.prototype.Mi=function(){var t=this;this.zi=this.zi.then((function(){return t.panelOpen(!0),n.OffcanvasUtils.open({selector:"#"+t.contentFrameDrawerId,content:"#"+t.mainContentId,displayMode:"overlay",autoDismiss:"none"})}))},s.prototype.Ci=function(){var t=this;this.zi=this.zi.then((function(){return t.panelOpen(!1),n.OffcanvasUtils.close({selector:"#"+t.contentFrameDrawerId})}))},s.prototype.sv=function(t){var e,n,i=this,r=t.lifecycleListener;r?(e=r.transitionCompleted,n=r.activated):(r={},t.lifecycleListener=r),r.transitionCompleted=function(){i.panelLoading(!1),o.isFunction(e)&&e.apply(this,arguments)},r.activated=function(){i.panelLoading(!0),o.isFunction(n)&&n.apply(this,arguments)}},s.prototype.rv=function(t){var e=this,n=t.params;n||(n={},t.params=n),n.closePanelCallback=function(){e.selectedToolbarButtons([])}},s.prototype.ov=function(e){var n=(o.isObjectStrict(e)&&e instanceof t?e.find("#"+this.mainContentId):t("#"+this.mainContentId)).children().get(0);return n?i.dataFor(n):null},s.prototype.hv=function(t,e,n,i,r){var s=this.ov(i);return o.isObjectStrict(s)&&o.isFunction(s[t])?s[t](e,n):r},s.prototype.uiShellBeforeDeselect=function(t,e){return this.hv("uiShellBeforeDeselect",t,e,e.fromContent,!0)},s.prototype.uiShellDeselect=function(t,e){return this.hv("uiShellDeselect",t,e,e.fromContent,void 0)},s.prototype.uiShellBeforeSelect=function(t,e){return this.hv("uiShellBeforeSelect",t,e,e.toContent,!0)},s.prototype.uiShellSelect=function(t,e){return this.hv("uiShellSelect",t,e,e.toContent,void 0)},s.prototype.uiShellBeforeClose=function(t,e){return this.hv("uiShellBeforeClose",t,e,e?e.content:null,!0)},s.prototype.uiShellClose=function(t,e){return this.hv("uiShellClose",t,e,e?e.content:null,void 0)},s}));