define(["knockout","ojs/ojcore","jquery","jraf/jrafcore","jraf/models/UIShellManager","jraf/services/ServiceManager","jraf/utils/ValidationUtils","ojs/ojnavigationlist","ojs/ojarraytabledatasource"],(function(e,t,a,n,i,r,o){"use strict";var u=t.Translations.getTranslatedString;function l(e){var t=this;this.navMenuId=n.UIShell.generateUniqueId(),this.appListDescription=u("jraf.sidebar.appListDescription"),this.loadingText=u("jraf.messages.loading"),this.currentSelectionLabel=u("jraf.common.currentSelectionLabel"),this._appName=n.App.getApplicationName(),this._launchApplicationCallback=o.isObjectStrict(e)&&o.isFunction(e.launchApplicationCallback)?e.launchApplicationCallback:null,this.layout=o.isObjectStrict(e)&&o.isString(e.layout)?e.layout:"",this.getAppListHeight=function(){var e="";return"horizontal"!==t.layout&&(void 0===(e=a(".jraf-global-header-wrapper").outerHeight(!0))&&(e=a(".jraf-mobile-nav-header").outerHeight(!0)),e="calc(100vh - "+(e+=a(".jraf-menu-header-text").outerHeight(!0))+"px)"),e},this._initializeMenu(),this.beforeSelect=function(e,a){t._handleMenuBeforeSelect(e,a)}}return l.prototype._initializeMenu=function(){this.menuDataLoaded=e.observable(),this._menuDataMap={},this.navData=e.observableArray([]),this.navDataSource=new t.ArrayTableDataSource(this.navData,{idAttribute:"domId"}),this._appNavService=r.getAppNavigatorService(),this._loadMenuData()},l.prototype._loadMenuData=function(){var e=this;return this.menuDataLoaded(!1),i.startProcessingIndicator(),this._appNavService.loadNavigation().then((function(t){e._handleMenuLoadSuccess(t)}),(function(t){e._handleMenuLoadFailure(t)}))},l.prototype._handleMenuLoadSuccess=function(e){var t=this,a=0,n=this.navMenuId+"-entry-",r=e.filter((function(e){return!e.systemEntry})).map((function(e){return t._parseMenuItem(e,n+a++)}));r.unshift(this._getCurrentAppMenuItem(n+a)),this.navData(r),this.menuDataLoaded(!0),i.stopProcessingIndicator()},l.prototype._parseMenuItem=function(e,t){var a={label:e.name,domId:t,url:e.url,selected:!1};return this._menuDataMap[a.domId]=a,a},l.prototype._getCurrentAppMenuItem=function(e){return{label:this._appName,domId:e,url:null,selected:!0}},l.prototype._handleMenuLoadFailure=function(e){i.stopProcessingIndicator(),t.Logger.warn("NavigatorMenuBody._handleMenuLoadFailure: Failed to load app navigation data: ",e)},l.prototype._handleMenuBeforeSelect=function(e,t){e.preventDefault();var a=this._menuDataMap[e.detail.key],n=a.url;return a.selected||(this._launchApplicationCallback&&this._isSameOrigin(n)?this._launchApplicationCallback(n):window.open(n,"_blank")),!1},l.prototype._isSameOrigin=function(e){return this._getOrigin(window.location.href)===this._getOrigin(e)},l.prototype._getOrigin=function(e){var t=e.indexOf("://");t=t>=0?t+3:0;var a=[e.indexOf("#"),e.indexOf("?"),e.indexOf("/",t)].filter((function(e){return e>=0})).reduce((function(e,t){return Math.min(e,t)}),e.length);return e.substring(0,a)},l}));