define(["ojs/ojcore","knockout","jquery","jraf/jrafcore","jraf/utils/ValidationUtils","jraf/utils/KnockoutUtils","jraf/models/notifications/NotificationsFilter","jraf/models/notifications/NotificationsConfig","jraf/models/UIShellManager","ojs/ojmodule-element-utils","ojs/ojmodule-element","ojs/ojmodel","ojs/ojdialog","ojs/ojbutton","ojs/ojknockout","ojs/ojvalidation-number","ojs/ojconveyorbelt","jraf/composites/oj-rgbu-jraf-info-tile/loader","jraf/composites/oj-rgbu-jraf-apps-table/loader","jraf/composites/oj-rgbu-jraf-simple-grid/loader","jraf/composites/oj-rgbu-jraf-apps-module/loader"],(function(t,i,e,n,o,a,r,s,l,c){"use strict";f.FETCH_SIZE=50,f.READ_ICON_CLASS="jraf-notificationDetail-readIcon",f.UNREAD_ICON_CLASS="jraf-notificationDetail-unreadIcon",f.DEFAULT_TIME_LABEL_KEY="jraf.sidebar.notifications.filterTimePlaceholder",f.DEFAULT_TYPE_LABEL_KEY="jraf.sidebar.notifications.filterTypePlaceholder",f.DEFAULT_SEVERITY_LABEL_KEY="jraf.sidebar.notifications.filterSeverityPlaceholder",f.ALL_NOTIFICATIONS_CRITERIA={},f.ALL_UNREAD_CRITERIA={status:r.UNREAD_STATUS},f.UNREAD_NORMAL_CRITERIA={severities:[r.SEVERITY_VALUE_NORMAL],status:r.UNREAD_STATUS},f.UNREAD_IMPORTANT_CRITERIA={severities:[r.SEVERITY_VALUE_IMPORTANT],status:r.UNREAD_STATUS},f.UNREAD_CRITICAL_CRITERIA={severities:[r.SEVERITY_VALUE_CRITICAL],status:r.UNREAD_STATUS},f.GRAPH_COLOR_CRITICAL="#cd2027",f.GRAPH_COLOR_IMPORTANT="#eda620",f.GRAPH_COLOR_NORMAL="#72c17f",f.GRAPH_COLOR_OTHER="#e0e0e0",f.TILE_IDS=["allNotifications","unreadNotifications","unreadCritical","unreadImportant","unreadNormal","filters","grouping"];var u=t.Translations.getTranslatedString;function f(e){var o=this;this.lm(e),this.dataGridId=n.UIShell.generateUniqueId(),this.multipleAssignDialogId=n.UIShell.generateUniqueId(),this.createDialogId=n.UIShell.generateUniqueId(),this.notificationsTableLabel=u("jraf.notifications.detail.notificationsTableLabel"),this.rowsSelectedLabel=u("jraf.notifications.detail.rowsSelected"),this.assignmentDialogTitle=u("jraf.notifications.detail.assignmentDialogTitle"),this.peopleAssignmentsLabel=u("jraf.notifications.detail.assignmentPeople"),this.groupAssignmentsLabel=u("jraf.notifications.detail.assignmentGroups"),this.okLabel=u("jraf.common.ok"),this.readLabel=u("jraf.notifications.read"),this.unreadLabel=u("jraf.notifications.unread"),this.multipleFilterString=u("jraf.notifications.detail.multipleFilters"),this.singleAlertLabel=u("jraf.notifications.detail.singleAlertLabel"),this.currentAppTableSelection=i.observableArray([]),this.currentSelection=i.observableArray([]),this.selectedCount=i.pureComputed((function(){return this.currentSelection().length}),this),this.curRowAssignments=i.observableArray([]),this.assignDialogTarget=i.observable(),this.notificationsCollectionOffset=0;var a=t.Collection.extend({sync:function(t,i,e){return o.dm(t,i,e)},customPagingOptions:function(t){return o.mm(t)},parse:function(t){return o.pm(t)},fetchSize:f.FETCH_SIZE});this.notificationsCollection=new a,this.jm(),this.closeAssignmentDialog=function(){o.vm()},this.handleTileSelection=function(t){o.bm(t)},this.gm(),this.ym(),this.Nm(),this.Tm(),e.initialTile?this.ib.selectedTileIndex(e.initialTile):this.Lm()}return f.prototype.lm=function(t){var i=s.getInstance();this.renderNotificationReassignment=i.hasReassignNotificationSupport(),this.tm=i.getNotificationHandler(t.notificationHandlerKey),this.pe=this.tm.getNotificationsService(),this.ib=r.getInstance(this.pe),this.ib.selectedTileIndex(r.ALL_NOTIFICATIONS_TILE_INDEX)},f.prototype.Sm=function(){var t=this;return[{valueName:"severity",dataType:"text",label:u("jraf.notifications.detail.columnSeverity"),width:"100px",cellAlignment:"start",cellClassNameFunction:function(i){return t.Cm(i.data)}},{valueName:"notificationStatus",dataType:"icon",label:u("jraf.notifications.detail.columnStatus"),width:"60px"},{valueName:"notificationDesc",dataType:"custom",label:u("jraf.notifications.detail.columnMessage"),customRenderer:function(i){return t.Dm(i)},width:"350px",cellAlignment:"start"},{valueName:"notificationTypeDescription",dataType:"text",label:u("jraf.notifications.detail.columnType"),width:"180px",cellAlignment:"start"},{valueName:"alertCount",dataType:"custom",label:u("jraf.notifications.detail.columnAlerts"),customRenderer:function(i){return t.Am(i)},width:"125px",cellAlignment:"start",sortable:!1},{valueName:"recipients",dataType:"custom",label:u("jraf.notifications.detail.columnAssigned"),customRenderer:function(i){return t.Pm(i)},width:"125px",cellAlignment:"start",sortable:!1},{valueName:"createdDate",dataType:"date",label:u("jraf.notifications.detail.columnCreatedDate"),width:"150px",cellAlignment:"start"},{valueName:"createdBy",dataType:"text",label:u("jraf.notifications.detail.columnCreatedBy"),width:"125px",cellAlignment:"start"},{valueName:"lastUpdatedDate",dataType:"date",label:u("jraf.notifications.detail.columnUpdatedDate"),width:"150px",cellAlignment:"start"},{valueName:"lastUpdatedBy",dataType:"text",label:u("jraf.notifications.detail.columnUpdatedBy"),width:"125px",cellAlignment:"start"}]},f.prototype.jm=function(){var t=this,e=i.observable(!0),n=i.observable(!0);function o(){t.Im(!0)}function a(){t.Im(!1)}function r(){document.getElementById(t.createDialogId).open()}var s=i.pureComputed((function(){return 1!==t.selectedCount()})),l=i.pureComputed((function(){return t.selectedCount()<=0}));this.currentSelection.subscribe((function(i){e(!0),n(!0);for(var o=0;o<i.length;o++){t.notificationsCollection.models[i[o]].attributes.notificationStatus.isRead?n(!1):e(!1)}}));var c=[{label:u("jraf.notifications.detail.markRead"),callback:o,disabled:e},{label:u("jraf.notifications.detail.markUnread"),callback:a,disabled:n}];if(this.renderNotificationReassignment){var f={label:u("jraf.notifications.detail.reassignNotificationTitle"),callback:r,disabled:s};c.push(f)}var d=[{label:u("jraf.notifications.detail.markRead"),buttonHandler:o,disabled:e},{label:u("jraf.notifications.detail.markUnread"),buttonHandler:a,disabled:n}];if(this.renderNotificationReassignment){var m={label:u("jraf.notifications.detail.reassignLabel"),icon:"jraf-createNotification-icon",iconOnly:!0,buttonHandler:r,disabled:s};d.push(m)}this.notificationTable={collection:this.notificationsCollection,label:this.notificationsTableLabel,handleRefresh:function(){t.Lm()},handleDelete:function(){t.xm()},disableDelete:l,deleteLabel:u("jraf.appTable.deleteLabel"),refreshLabel:u("jraf.notifications.detail.refreshNotifications"),selection:this.currentAppTableSelection,selectionListener:function(i){t.uu(i)},columns:this.Sm(),multipleSelect:!0,actionMenu:c,extraButtons:d}},f.prototype.ym=function(){var e=this,n=t.Validation.converterFactory("number").createConverter({style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!0}),o=[{type:"value",converter:n},{type:"label",converter:n}];this.notificationCounts={totalNotifications:i.observable(0),unreadNormal:i.observable(0),unreadImportant:i.observable(0),unreadCritical:i.observable(0)},this.notificationCounts.unreadNotifications=i.pureComputed((function(){return e.notificationCounts.unreadCritical()+e.notificationCounts.unreadImportant()+e.notificationCounts.unreadNormal()})),this.notificationCounts.readNotifications=i.pureComputed((function(){return e.notificationCounts.totalNotifications()-e.notificationCounts.unreadNotifications()})),this.notificationCounts.unreadNonNormal=i.pureComputed((function(){return e.notificationCounts.unreadNotifications()-e.notificationCounts.unreadNormal()})),this.notificationCounts.unreadNonImportant=i.pureComputed((function(){return e.notificationCounts.unreadNotifications()-e.notificationCounts.unreadImportant()})),this.notificationCounts.unreadNonCritical=i.pureComputed((function(){return e.notificationCounts.unreadNotifications()-e.notificationCounts.unreadCritical()})),this.Fm=this.Um(),this.wm=this.km(),this.tileBindings=[{filterCriteria:f.ALL_NOTIFICATIONS_CRITERIA,tileId:f.TILE_IDS[0],severity:"none",type:"metric",metric:a.formatObservable(this.notificationCounts.totalNotifications,n),infoTitle:u("jraf.notifications.detail.allNotificationsTileLabel"),label:this.wm.allNotifications,selected:i.observable(!0),tileSelectionHandler:this.handleTileSelection,customBodyModuleOptions:{name:"jraf/tilecontent/MetricComparison",params:{metricData:[{name:u("jraf.notifications.read"),value:a.formatObservable(this.notificationCounts.readNotifications,n)},{name:u("jraf.notifications.unread"),value:a.formatObservable(this.notificationCounts.unreadNotifications,n)}]}}},{filterCriteria:f.ALL_UNREAD_CRITERIA,tileId:f.TILE_IDS[1],severity:"none",type:"metric",infoTitle:u("jraf.notifications.detail.allUnreadTileLabel"),label:this.wm.allUnread,selected:i.observable(!1),tileSelectionHandler:this.handleTileSelection,customBodyModuleOptions:{name:"jraf/tilecontent/SimpleDonutChart",params:{series:this.Mm([{name:r.SEVERITY_OPTIONS[0].label,color:f.GRAPH_COLOR_CRITICAL,items:[this.notificationCounts.unreadCritical]},{name:r.SEVERITY_OPTIONS[1].label,color:f.GRAPH_COLOR_IMPORTANT,items:[this.notificationCounts.unreadImportant]},{name:r.SEVERITY_OPTIONS[2].label,color:f.GRAPH_COLOR_NORMAL,items:[this.notificationCounts.unreadNormal]}]),groups:["All Unread Notifications"],valueFormats:o,centerLabel:a.formatObservable(this.notificationCounts.unreadNotifications,n)}}},{filterCriteria:f.UNREAD_CRITICAL_CRITERIA,tileId:f.TILE_IDS[2],severity:"high",type:"metric",infoTitle:r.SEVERITY_OPTIONS[0].label,label:this.wm.unreadCritical,selected:i.observable(!1),tileSelectionHandler:this.handleTileSelection,customBodyModuleOptions:{name:"jraf/tilecontent/SimpleDonutChart",params:{series:this.Mm([{name:r.SEVERITY_OPTIONS[0].label,color:f.GRAPH_COLOR_CRITICAL,items:[this.notificationCounts.unreadCritical]},{name:u("jraf.notifications.detail.graphLabelOther"),color:f.GRAPH_COLOR_OTHER,items:[this.notificationCounts.unreadNonCritical]}]),groups:["Critical Unread Notifications"],valueFormats:o,centerLabel:a.formatObservable(this.notificationCounts.unreadCritical,n)}}},{filterCriteria:f.UNREAD_IMPORTANT_CRITERIA,tileId:f.TILE_IDS[3],severity:"medium",type:"metric",infoTitle:r.SEVERITY_OPTIONS[1].label,label:this.wm.unreadImportant,selected:i.observable(!1),tileSelectionHandler:this.handleTileSelection,customBodyModuleOptions:{name:"jraf/tilecontent/SimpleDonutChart",params:{series:this.Mm([{name:r.SEVERITY_OPTIONS[1].label,color:f.GRAPH_COLOR_IMPORTANT,items:[this.notificationCounts.unreadImportant]},{name:u("jraf.notifications.detail.graphLabelOther"),color:f.GRAPH_COLOR_OTHER,items:[this.notificationCounts.unreadNonImportant]}]),groups:["Important Unread Notifications"],valueFormats:o,centerLabel:a.formatObservable(this.notificationCounts.unreadImportant,n)}}},{filterCriteria:f.UNREAD_NORMAL_CRITERIA,tileId:f.TILE_IDS[4],severity:"low",type:"metric",infoTitle:r.SEVERITY_OPTIONS[2].label,label:this.wm.unreadNormal,selected:i.observable(!1),tileSelectionHandler:this.handleTileSelection,customBodyModuleOptions:{name:"jraf/tilecontent/SimpleDonutChart",params:{series:this.Mm([{name:r.SEVERITY_OPTIONS[2].label,color:f.GRAPH_COLOR_NORMAL,items:[this.notificationCounts.unreadNormal]},{name:u("jraf.notifications.detail.graphLabelOther"),color:f.GRAPH_COLOR_OTHER,items:[this.notificationCounts.unreadNonNormal]}]),groups:["Normal Unread Notifications"],valueFormats:o,centerLabel:a.formatObservable(this.notificationCounts.unreadNormal,n)}}},{render:this.Fm.renderFilters,filterCriteria:this.ib.getFilterCriteria(),tileId:f.TILE_IDS[5],severity:"none",type:"metric",infoTitle:u("jraf.notifications.detail.filterTileLabel"),label:this.wm.filters,selected:i.observable(!1),tileSelectionHandler:this.handleTileSelection,customBodyModuleOptions:{name:"jraf/tilecontent/ValueList",params:{values:[{label:u("jraf.notifications.detail.filterTileTimeLabel"),value:this.Fm.time},{label:u("jraf.notifications.detail.columnType"),value:this.Fm.type},{label:u("jraf.notifications.detail.columnSeverity"),value:this.Fm.severity}]}}},{render:this.Fm.renderGroups,filterCriteria:this.ib.getGroupingCriteria(),tileId:f.TILE_IDS[6],severity:"none",type:"metric",infoTitle:u("jraf.notifications.detail.groupTileLabel"),label:this.wm.summary,selected:i.observable(!1),tileSelectionHandler:this.handleTileSelection,customBodyModuleOptions:{name:"jraf/tilecontent/ValueList",params:{values:[{label:this.Fm.primaryGroup,value:this.Fm.primaryValue},{label:this.Fm.secondaryGroup,value:this.Fm.secondaryValue},{message:u("jraf.notifications.detail.groupTileFilterMessage")}]}}}]},f.prototype.Mm=function(t){return i.pureComputed((function(){return i.toJS(t)}))},f.prototype.dm=function(i,e,n){if(t.Logger.info("NotificationsPage._syncNotificationsCollection: Calling sync for method: %s",i),"read"!==i)return t.Logger.warn("NotificationsPage._syncNotificationsCollection: Method was not read!"),{};var o=this;return this.Bm(n).then((function(t){n.success(t)}),(function(t){o.Id(t),n.error(t)})),{}},f.prototype.Om=function(){var t=this;this.pe.getNotificationCount(f.ALL_NOTIFICATIONS_CRITERIA).then((function(i){t.notificationCounts.totalNotifications(i)})),this.pe.getNotificationCount(f.UNREAD_NORMAL_CRITERIA).then((function(i){t.notificationCounts.unreadNormal(i)})),this.pe.getNotificationCount(f.UNREAD_IMPORTANT_CRITERIA).then((function(i){t.notificationCounts.unreadImportant(i)})),this.pe.getNotificationCount(f.UNREAD_CRITICAL_CRITERIA).then((function(i){t.notificationCounts.unreadCritical(i)}))},f.prototype.Um=function(){var t=this,e=u(f.DEFAULT_TIME_LABEL_KEY),n=u(f.DEFAULT_TYPE_LABEL_KEY),o=u(f.DEFAULT_SEVERITY_LABEL_KEY),a={time:this._m(this.ib.selectedTimePeriod,this.ib.timePeriodLabels,e),type:this.Hm(this.ib.selectedNotificationTypes,this.ib.notificationTypeLabels,n),primaryGroup:this.Hm(this.ib.selectedSummaryValues.primaryGroup,this.ib.hierarchyLabels),primaryValue:this.ib.selectedSummaryValues.primaryValue,secondaryGroup:this.Hm(this.ib.selectedSummaryValues.secondaryGroup,this.ib.hierarchyLabels),secondaryValue:this.ib.selectedSummaryValues.secondaryValue,severity:this.Hm(this.ib.selectedSeverities,this.ib.severityLabels,o)};return a.renderFilters=i.pureComputed((function(){return 0<(t.ib.selectedTimePeriod()?1:0)+t.ib.selectedNotificationTypes().length+t.ib.selectedSeverities().length})),a.renderGroups=i.pureComputed((function(){return!!a.primaryGroup()})),a},f.prototype.Hm=function(t,e,n){return i.pureComputed((function(){var i=t();return o.isArray(i)?1<i.length?u("jraf.notifications.detail.multipleFilters"):0===i.length?n||u("jraf.notifications.detail.noFilters"):e()[i[0]]:null}))},f.prototype._m=function(t,e,n){return i.pureComputed((function(){var i=t();return i?e()[i]:n||u("jraf.notifications.detail.noFilters")}))},f.prototype.km=function(){var t=this,e={};return e.allNotifications=i.pureComputed((function(){var i=t.notificationCounts.totalNotifications(),e=t.notificationCounts.unreadNotifications(),n=t.notificationCounts.readNotifications();return u("jraf.notifications.detail.allNotificationsTileAriaLabel",[i,e,n])})),e.allUnread=i.pureComputed((function(){var i=t.notificationCounts.unreadNotifications(),e=t.notificationCounts.unreadCritical(),n=t.notificationCounts.unreadImportant(),o=t.notificationCounts.unreadNormal();return u("jraf.notifications.detail.allUnreadTileAriaLabel",[i,e,n,o])})),e.unreadCritical=i.pureComputed((function(){var i=t.notificationCounts.unreadNotifications(),e=t.notificationCounts.unreadCritical();return u("jraf.notifications.detail.unreadCriticalTileAriaLabel",[i,e])})),e.unreadImportant=i.pureComputed((function(){var i=t.notificationCounts.unreadNotifications(),e=t.notificationCounts.unreadImportant();return u("jraf.notifications.detail.unreadImportantTileAriaLabel",[i,e])})),e.unreadNormal=i.pureComputed((function(){var i=t.notificationCounts.unreadNotifications(),e=t.notificationCounts.unreadNormal();return u("jraf.notifications.detail.unreadNormalAriaLabel",[i,e])})),e.filters=i.pureComputed((function(){var i=t.Fm.time(),e=t.Fm.type(),n=t.Fm.severity();return u("jraf.notifications.detail.filterByAriaLabel",[i,e,n])})),e.summary=i.pureComputed((function(){var i=t.Fm.primaryValue(),e=t.Fm.secondaryValue();return u("jraf.notifications.detail.summaryAriaLabel",[i,e])})),e},f.prototype.Nm=function(){var t=this;this.Rm=r.ALL_NOTIFICATIONS_TILE_INDEX;var i=this.ib.selectedTileIndex.subscribe((function(i){t.Vm(i)}));this.uiShellClose=function(){i.dispose()}},f.prototype.gm=function(){if(this.renderNotificationReassignment){var e=this,n=i.pureComputed((function(){if(1!==e.selectedCount())return null;var i=e.currentSelection()[0];return i>=e.notificationsCollection.models.length?(t.Logger.warn("NotificationsPage (default selected notification logic): Selected notification index was out of bounds."),null):e.notificationsCollection.models[i].attributes.notificationSummary}));this.createNotificationDialogModuleOptions={name:"jraf/notifications/CreateNotification",params:{dialogId:this.createDialogId,dialogTitle:u("jraf.notifications.detail.reassignNotificationTitle"),createFailedMsg:u("jraf.notifications.detail.reassignFailed"),defaultNotification:n,notificationsService:this.pe,createCallback:function(){e.Lm()}}}}},f.prototype.Vm=function(t){var i=this.Rm;t!==r.FILTER_TILE_INDEX||this.Fm.renderFilters()?i!==t?(this.tileBindings[i].selected(!1),this.tileBindings[t].selected(!0),this.Rm=t,this.Lm()):t!==r.SUMMARY_TILE_INDEX&&t!==r.FILTER_TILE_INDEX||this.Lm():this.ib.selectedTileIndex(r.ALL_NOTIFICATIONS_TILE_INDEX)},f.prototype.Lm=function(){this.Om(),this.Em()},f.prototype.Em=function(){this.notificationsCollectionOffset=0,this.currentSelection([]),this.currentAppTableSelection.removeAll(),this.notificationsCollection.refresh()},f.prototype.Gm=function(){return this.tileBindings[this.ib.selectedTileIndex()]},f.prototype.zm=function(){var t=this.Gm();return i.unwrap(t.filterCriteria)||f.ALL_NOTIFICATIONS_CRITERIA},f.prototype.Bm=function(i){t.Logger.info("NotificationsPage._loadNotifications: Entering."),l.startProcessingIndicator(),i=i||{},this.notificationsCollectionOffset=i.startIndex||0;var n=i.fetchSize,o={pageNumber:Math.floor(i.startIndex/n)+1||1,pageSize:n,sortColumns:this.notificationsCollection.sortCriteria},a=this.zm();return e.extend(o,a),this.pe.getNotifications(o)},f.prototype.pm=function(i){t.Logger.info("NotificationsPage._handleDataLoadSuccess: Successfully loaded notification data.");var e=[];return i&&o.isArray(i.results)&&(e=this.qm(i.results)),l.stopProcessingIndicator(),e},f.prototype.Id=function(i){t.Logger.warn("NotificationsPage._handleDataLoadFailure: failed loading data with reason "+i),l.stopProcessingIndicator()},f.prototype.mm=function(i){t.Logger.info("NotificationsPage._getPagingOptions: Entering.");var e=i.totalRecordCount>this.notificationsCollectionOffset+i.results.length;return{totalResults:i.totalRecordCount,limit:f.FETCH_SIZE,count:i.results.length,offset:this.notificationsCollectionOffset,hasMore:e}},f.prototype.Km=function(t){var i=t.notificationStatus===r.READ_STATUS,e=r.SEVERITY_OPTIONS[t.severity-1].label;return{id:t.notificationId,severity:e,notificationStatus:{isRead:i,icon:i?f.READ_ICON_CLASS:f.UNREAD_ICON_CLASS,label:i?this.readLabel:this.unreadLabel},notificationDesc:{notificationId:t.notificationId,description:t.notificationDesc,launchable:t.launchable},notificationTypeDescription:t.notificationTypeDescription,alertCount:{notificationId:t.notificationId,count:t.alertCount},recipients:{notificationId:t.notificationId,displayValue:this.Jm(t),multipleAssigned:t.multipleRecipients},createdDate:new Date(t.createdDate),createdBy:t.createdBy,lastUpdatedDate:new Date(t.lastUpdatedDate),lastUpdatedBy:t.lastUpdatedBy,notificationSummary:{id:t.notificationId,message:t.notificationDesc,launchable:t.launchable,severity:e,hierarchy:[t.hierValue1,t.hierValue2,t.hierValue3,t.hierValue4,t.hierValue5,t.hierValue6,t.hierValue7,t.hierValue8,t.hierValue9]}}},f.prototype.Jm=function(t){return t.multipleRecipients?u("jraf.notifications.detail.multipleUsers"):o.isArray(t.recipients)&&t.recipients[0]||""},f.prototype.xm=function(){t.Logger.info("NotificationsPage._deleteSelectedNotification: Entering.");var i=this;return l.startProcessingIndicator(),this.Qm().then((function(e){i.pe.deleteMultipleNotifications(e).then((function(){i.Lm(),l.stopProcessingIndicator()}),(function(i){t.Logger.warn("NotificationsPage._deleteSelectedNotification: Failed to delete notifications (%s)",i),l.stopProcessingIndicator()}))}))},f.prototype.qm=function(t){for(var i=[],e=0;e<t.length;e++){var n=t[e];i.push(this.Km(n))}return i},f.prototype.uu=function(t){var i=[];if(t){var e={};for(var n in t)for(var o=t[n],a=o.startIndex.row;a<=o.endIndex.row;a++)e[a]=!0;i=Object.keys(e)}for(var r=[],s=0;s<i.length;s++)r.push(parseInt(i[s]));this.currentSelection(r)},f.prototype.Wm=function(i,n){t.Logger.info("NotificationsPage._openAssignmentDialog: Loading notification recipients.");var o=this;return l.startProcessingIndicator(),this.assignDialogTarget(i),this.pe.getRecipients(n).then((function(t){o.curRowAssignments(t),e("#"+o.multipleAssignDialogId).ojDialog("open"),l.stopProcessingIndicator()}),(function(i){t.Logger.warn("NotificationsPage._openAssignmentDialog: Error loading recipients: ",i),l.stopProcessingIndicator()}))},f.prototype.vm=function(){e("#"+this.multipleAssignDialogId).ojDialog("close")},f.prototype.Qm=function(){for(var t=this.currentSelection(),i=[],e=0;e<t.length;e++)i.push(this.notificationsCollection.at(t[e]));return Promise.all(i).then((function(t){for(var i=[],e=0;e<t.length;e++)i.push(t[e].attributes.id);return i}))},f.prototype.Im=function(i){t.Logger.info("NotificationsPage._updateReadState: Updating read state to "+i);var e=this;return l.startProcessingIndicator(),this.Qm().then((function(n){e.pe.markMultipleNotificationsAsRead(n,i).then((function(){l.stopProcessingIndicator(),e.Lm()}),(function(i){t.Logger.warn("NotificationsPage._updateReadState: Failed to update read state of notifications (%s)",i),l.stopProcessingIndicator()}))}))},f.prototype.bm=function(t){for(var i=0;i<this.tileBindings.length;i++)if(this.tileBindings[i].tileId===t){this.ib.selectedTileIndex(i);break}},f.prototype.Cm=function(t){for(var i in r.SEVERITY_OPTIONS)if(t===r.SEVERITY_OPTIONS[i].label)return r.SEVERITY_OPTIONS[i].class;return""},f.prototype.Dm=function(t){var i=t.data;if(!i.launchable)return i.description;var n=this;return e("<a></a>").attr("href","#").text(i.description).click((function(){n.Xm(i)})).get(0)},f.prototype.Am=function(t){var i=t.data.count;if(!i||i<1)return"";var n=1===i?this.singleAlertLabel:u("jraf.notifications.detail.multipleAlertsLabel",[i]),o=this;return e("<a></a>").attr("href","#").text(n).click((function(){o.Ym(t.data.notificationId)})).get(0)},f.prototype.Tm=function(){this.alertsPopupId=n.UIShell.generateUniqueId(),this.alertsNotificationId=i.observable(),this.alertsModuleConfig=c.createConfig({name:"jraf/notifications/AlertsPopup",params:{popupId:this.alertsPopupId,notificationId:this.alertsNotificationId}})},f.prototype.Ym=function(t){this.alertsNotificationId(t),document.getElementById(this.alertsPopupId).open()},f.prototype.Pm=function(t){var i=this,n=t.data,o=n.displayValue;if(!n.multipleAssigned)return o;var a=document.createElement("a");return a.attributes.href="#",a.textContent=o,e(a).click((function(){i.Wm(a,n.notificationId)})),a},f.prototype.Xm=function(i){if(!i.launchable)return Promise.resolve(null);l.startProcessingIndicator();var e=i.notificationId;return Promise.all([this.pe.markNotificationAsRead(e).catch((function(){t.Logger.warn("NotificationsPage._launchNotificationContext: Failed to mark notification as read.")})),this.tm.openContext(e).catch((function(){t.Logger.warn("NotificationsPage._launchNotificationContext: Failed to open notification context.")}))]).then((function(){l.stopProcessingIndicator()}))},f}));