define(["knockout","ojs/ojlogger","ojs/ojresponsiveutils","ojs/ojresponsiveknockoututils","ojs/ojoffcanvas","jraf/composites/utils/TranslationLoaderUtil","module","ojs/ojtoolbar","ojs/ojbutton","ojs/ojoffcanvas","ojs/ojknockout"],(function(t,e,i,o,n,s,a){"use strict";function l(t){var i=this;this.J=l.y.getTranslations(),this.M(t),this.N=this.J.then((function(t){i.yi(t),e.info("oj-rgbu-jraf-content-frame: component initialized.")}))}return l.CHANGEABLE_PROPERTIES={"additionalInfo.disabled":"additionalInfoDisabled","contextualHelp.disabled":"contextualHelpDisabled"},l.y=new s("oj-rgbu-jraf-content-frame",a.id),l.prototype.activated=function(){return this.N},l.prototype.bindingsApplied=function(){var i=this;e.info("oj-rgbu-jraf-content-frame.bindingsApplied: Subscribing to custom button state changes."),this.ki=[],this.renderCustomButtons&&this.customButtons.forEach((function(e){t.isSubscribable(e.disabled)&&i.ki.push(e.disabled.subscribe((function(){this.gi()}),i)),t.isSubscribable(e.label)&&i.ki.push(e.label.subscribe((function(){this.gi()}),i))}))},l.prototype.disconnected=function(){e.info("oj-rgbu-jraf-content-frame.disconnected: Disposing subscriptions to custom button states."),this.ki.forEach((function(t){t.dispose()}))},l.prototype.M=function(e){var n=this,s=e.properties,a=e.uniqueId;this.toolbarId=a+"_toolbar",this.customButtonsSetId=a+"_customButtonsSet",this.defaultButtonsSetId=a+"_defaultButtonsSet",this.mainContentId=a+"_mainContent",this.contentFrameDrawerId=a+"_contentFrameDrawer",this.xi=[],this.activePanel=t.observable(),this.isPanelActive=t.observable(!1),this.selectedPanelTitle=t.observable(),this.panelLoading=t.observable(!1),this.panelOpen=t.observable(!1);var l=o.createScreenRangeObservable();this.isSmallScreen=t.pureComputed((function(){return l()===i.SCREEN_RANGE.SM})),this.showModalOverlay=t.pureComputed((function(){return this.panelOpen()&&this.isSmallScreen()}),this),this.compactMainContent=t.pureComputed((function(){return this.panelOpen()&&!this.isSmallScreen()}),this),this.headerTitle=s.header,this.customButtons=s.customButtons,this.Di=Array.isArray(this.customButtons)?this.customButtons.length:0,this.renderCustomButtons=0<this.Di,this._i=t.observable(s.additionalInfo.label),this.additionalInfoDisabled=t.observable(s.additionalInfo.disabled),this.wi=t.observable(s.contextualHelp.label),this.contextualHelpDisabled=t.observable(s.contextualHelp.disabled),this.compact=t.observable(s.compact),this.renderSeparator=this.renderCustomButtons&&(s.additionalInfo.displayed||s.contextualHelp.displayed),this.contextualAreaCount=e.slotCounts.contextualArea,this.isContextualPanelRendered=function(t){return n.Ai(t)},this.closePanel=function(){n.Ci()},this.handleCustomButtonChange=function(t){n.Ii(t,!0)},this.handleDefaultButtonChange=function(t){n.Ii(t,!1)},this.getButtonIconClass=function(t){return n.Hi(t)},this.Si(s),this.Bi()},l.prototype.yi=function(t){this.toolbarLabel=this.headerTitle+" "+t.toolbarLabel,this._i(this._i()||t.additionalInfoLabel),this.wi(this.wi()||t.contextualHelpLabel),this.closeLabel=t.closeLabel},l.prototype.Si=function(t){this.defaultButtons=[],t.additionalInfo.displayed&&this.defaultButtons.push({label:this._i,disabled:this.additionalInfoDisabled,iconClass:"oj-rgbu-jraf-content-frame-additional-info-icon"}),t.contextualHelp.displayed&&this.defaultButtons.push({label:this.wi,disabled:this.contextualHelpDisabled,iconClass:"oj-rgbu-jraf-content-frame-help-icon"}),this.Ti={};var e=this.customButtons;if(this.renderCustomButtons)for(var i=0;i<this.Di;i++){var o=e[i];this.Ti[i]=o}for(var n=this.Di,s=0;n<this.Di+this.defaultButtons.length;n++,s++){var a=this.defaultButtons[s];this.Ti[n]=a}this.zi=Promise.resolve()},l.prototype.Bi=function(){this.selectedCustomButton=t.observableArray([]),this.selectedDefaultButton=t.observableArray([]),this.selectedCustomButton.subscribe((function(t){1===t.length&&this.selectedDefaultButton([])}),this),this.selectedDefaultButton.subscribe((function(t){1===t.length&&this.selectedCustomButton([])}),this)},l.prototype.Ii=function(t,e){var i=t.detail.previousValue,o=t.detail.value,n=e?this.selectedCustomButton:this.selectedDefaultButton,s=e?this.selectedDefaultButton:this.selectedCustomButton;if(Array.isArray(i)&&1===i.length&&1<o.length){var a=i[0];n(o.filter((function(t){return t!==a})))}else 0!==o.length||0!==s().length?0!==o.length&&this.Ei(e?this.selectedCustomButton()[0]:this.Fi()):this.closeContextualArea()},l.prototype.Fi=function(){return this.selectedDefaultButton()[0]+this.Di},l.prototype.Hi=function(e){return t.pureComputed((function(){var i=e.jrafAppliedButtonIconClass||{};Object.keys(i).forEach((function(t){i[t]=!1}));var o=t.unwrap(e.iconClass);return o&&"string"==typeof o&&(i[o]=!0),e.jrafAppliedButtonIconClass=i}))},l.prototype.Ei=function(i){e.info("oj-rgbu-jraf-content-frame: displaying panel %d",i);var o=t.unwrap(this.Ti[i].label);this.selectedPanelTitle(o),this.Li(i),this.panelOpen()||this.Mi()},l.prototype.Li=function(t){this.activePanel(t),this.isPanelActive(!0)},l.prototype.Mi=function(){var t=this;this.zi=this.zi.then((function(){return t.panelOpen(!0),n.open({selector:"#"+t.contentFrameDrawerId,displayMode:"overlay",autoDismiss:"none"})}))},l.prototype.Ci=function(){var t=this;this.zi=this.zi.then((function(){return t.panelOpen(!1),n.close({selector:"#"+t.contentFrameDrawerId})})),this.selectedCustomButton([]),this.selectedDefaultButton([])},l.prototype.Ai=function(t){return t===this.activePanel()},l.prototype.openContextualArea=function(t){if("number"!=typeof t||t<0||t>=this.Di+this.defaultButtons.length)throw new TypeError("oj-rgbu-jraf-content-frame.openContextualArea: panelIndex is out of range");t<this.Di?this.selectedCustomButton([t]):this.selectedDefaultButton([t-this.Di])},l.prototype.closeContextualArea=function(){this.panelOpen()&&this.Ci()},l.prototype.propertyChanged=function(t){var e=t.property;if("external"===t.updatedFrom){if("additionalInfo"===e||"contextualHelp"===e){var i=t.subproperty.path;this[l.CHANGEABLE_PROPERTIES[i]](t.subproperty.value),this.gi()}"compact"===e&&this[e](t.value)}},l.prototype.gi=function(){document.getElementById(this.toolbarId).refresh()},l}));