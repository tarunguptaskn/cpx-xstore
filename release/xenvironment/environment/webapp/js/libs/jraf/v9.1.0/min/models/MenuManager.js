define(["ojs/ojcore","knockout","jquery","ojs/ojoffcanvas"],(function(e,n,t){"use strict";function i(t){if("object"!=typeof t||null===t||"string"!=typeof t.drawerId||t.drawerId.length<=0||"string"!=typeof t.appContentContainerId||t.appContentContainerId.length<=0||!n.isObservable(t.opened)||!n.isObservable(t.pinned)||!n.isObservable(t.selectedMenuItemId)||!n.isObservable(t.activeMenuModuleBinding)||!Array.isArray(t.menuItems))throw new TypeError("MenuManager: Invalid configuration.");this.menuDrawerSelector="#"+t.drawerId,this.appContentContainerSelector="#"+t.appContentContainerId,this.displayMode=i.DISPLAY_MODE_OVERLAY,this.menuOpened=t.opened,this.menuPinned=t.pinned,this.menuOpened(!1),this.menuPinned(!1),this.menuClosing=n.observable(!1),this.selectedMenuItemId=t.selectedMenuItemId,this.activeMenuModuleBinding=t.activeMenuModuleBinding,this.contentAreaResizedCallback=t.contentAreaResizedCallback,this.defaultSelectedMenuItemId=this.selectedMenuItemId(),this.defaultMenuModuleBinding=this.activeMenuModuleBinding(),e.Logger.info("MenuManager: default selected menu item id is %s.",this.defaultSelectedMenuItemId),this.menuItems=t.menuItems,this.Vo()}return i.DISPLAY_MODE_PIN="pin",i.DISPLAY_MODE_OVERLAY="overlay",i.prototype.Vo=function(){var e=this;t(this.menuDrawerSelector).on("ojclose",(function(){e.eh()})),t(this.appContentContainerSelector).on("click",(function(){e.rh()}))},i.prototype.eh=function(){this.menuClosing(!1)},i.prototype.rh=function(){e.Logger.info("MenuManager._handleAppContentAreaClickEvent: Entering."),this.menuOpened()&&!this.menuPinned()&&(e.Logger.info("MenuManager._handleAppContentAreaClickEvent: Closing menu overlay."),this.closeMenu({closeOverlayMenuOnly:!0}))},i.prototype.closeMenu=function(n){if(e.Logger.info("MenuManager.closeMenu: Entering."),this.menuOpened()){var t=!1;"object"==typeof n&&null!==n&&"boolean"==typeof n.closeOverlayMenuOnly&&(t=n.closeOverlayMenuOnly);var o=this;if(!t||t&&this.displayMode===i.DISPLAY_MODE_OVERLAY){var s=this.oh();return this.uh(s).then((function(){o.fh()}))}}return new Promise((function(e,n){e("MenuManager did not close menu.")}))},i.prototype.openMenu=function(n){if(e.Logger.info("MenuManager.openMenu: Entering."),"object"!=typeof n||null===n||!this.ch(n.displayMode))throw new TypeError("MenuManager: Invalid menuParams. displayMode is required.");if(this.menuClosing())return Promise.resolve();"string"==typeof n.menuItemId&&this.lh(n.menuItemId),n.displayMode===i.DISPLAY_MODE_PIN||n.displayMode===i.DISPLAY_MODE_OVERLAY&&this.Mh()?this.displayMode=i.DISPLAY_MODE_PIN:this.displayMode=i.DISPLAY_MODE_OVERLAY,this.menuOpened(!0),this.displayMode===i.DISPLAY_MODE_PIN&&this.menuPinned(!0);var t=this,o=this.dh();return this.ph(o).then((function(){t.fh()}))},i.prototype.ch=function(e){return e===i.DISPLAY_MODE_PIN||e===i.DISPLAY_MODE_OVERLAY},i.prototype.oh=function(){return{selector:this.menuDrawerSelector}},i.prototype.dh=function(){return{selector:this.menuDrawerSelector,content:this.appContentContainerSelector,displayMode:i.DISPLAY_MODE_OVERLAY,autoDismiss:"none",modality:"modeless"}},i.prototype.lh=function(e){if(this.selectedMenuItemId()!==e){var n=this.yh(e);if(null===n)throw new Error("MenuManager: No menu item identified by: "+e);this.selectedMenuItemId(e),this.activeMenuModuleBinding(n.getSidebarMenuModuleBinding())}},i.prototype.yh=function(e){for(var n=null,t=0;t<this.menuItems.length;t++){var i=this.menuItems[t];if(i.getId()===e){n=i;break}}return n},i.prototype.Mh=function(){return this.displayMode===i.DISPLAY_MODE_PIN&&this.menuOpened()},i.prototype.uh=function(n){return this.menuOpened(!1),this.menuPinned(!1),this.menuClosing(!0),this.displayMode===i.DISPLAY_MODE_PIN&&t(this.appContentContainerSelector).removeClass("jraf-menu-pinned"),e.OffcanvasUtils.close(n)},i.prototype.ph=function(n){return this.displayMode===i.DISPLAY_MODE_PIN&&t(this.appContentContainerSelector).addClass("jraf-menu-pinned"),e.OffcanvasUtils.open(n)},i.prototype.resetMenu=function(){this.selectedMenuItemId(null),this.activeMenuModuleBinding(null),this.selectedMenuItemId(this.defaultSelectedMenuItemId),this.activeMenuModuleBinding(this.defaultMenuModuleBinding)},i.prototype.fh=function(){"function"==typeof this.contentAreaResizedCallback&&this.displayMode===i.DISPLAY_MODE_PIN&&this.contentAreaResizedCallback()},i}));