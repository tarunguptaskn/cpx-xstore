define(["ojs/ojcore","knockout","jquery","jraf/jrafcore","jraf/utils/ValidationUtils","jraf/models/Content","jraf/models/UIShellManager","jraf/models/tasks/TasksListModel","ojs/ojknockouttemplateutils","ojs/ojarraydataprovider","ojs/ojknockout","ojs/ojbutton","ojs/ojlistview","ojs/ojselectcombobox","ojs/ojmodule"],(function(t,e,i,s,r,a,n,o,h,l){"use strict";var u=t.Translations.getTranslatedString;function c(i){if(t.Logger.info("UIShellTasksMenu: Entering constructor."),!(r.isObjectStrict(i)&&r.isNonemptyString(i.header)&&r.isNonemptyString(i.navListLabel)&&r.isNonemptyString(i.searchPlaceholderText)&&r.isNonemptyString(i.autosuggestAdditionalResultsText)&&r.isFunction(i.getTasks)))throw new TypeError("UIShellTasksMenu: Missing required parameters.");var a=this;this.expandCollapseButtonId=s.UIShell.generateUniqueId(),this.navListId=s.UIShell.generateUniqueId(),this.searchInputId=s.UIShell.generateUniqueId(),this.autosuggestOptionTemplateId=s.UIShell.generateUniqueId(),this.nk(i),this.ek(),this.rk(i),this.ak(),this.navigateUpHierarchy=function(){a.yd()},this.hierarchyNodeSelection=e.observableArray([]),this.handleHierarchyOptionChange=function(t){0!==t.detail.value.length&&(a.hierarchyNodeSelection([]),a.ik(t.detail.value[0]))},this.tasksListBodyModule={name:"jraf/tasks/TasksMenuBody",params:{navListId:this.navListId,navListLabel:i.navListLabel,openContentCallback:function(t){a.Rg(t)},tasksModel:this.tk}},this.getAutosuggestOptionTemplate=function(){return h.getRenderer(a.autosuggestOptionTemplateId)}}return c.prototype.ak=function(){var t=this;this.handleDetached=function(){t.searchString.pop()},n.getMenuDrawerState().subscribe((function(e){e||t.searchString.pop()}))},c.prototype.nk=function(t){this.tk=new o({getTasks:t.getTasks,taskId:t.taskId,favoritesEnabled:t.favoritesEnabled,favoritesType:t.favoritesType}),this.hierarchyDrillPath=this.tk.getHierarchyDrillPath(),this.drilledNode=this.tk.getDrilledNode(),this.rootNodeLabel=u(t.header),this.hierarchyDrillPathDataProvider=new l(this.hierarchyDrillPath,{keyAttributes:"id"}),this.drilledNodeLabel=e.pureComputed((function(){return this.drilledNode().label}),this),this.isHierarchyRoot=e.pureComputed((function(){return this.hierarchyDrillPath().length<1}),this),this.isHierarchyRoot.subscribe((function(t){t&&this.hk()}),this)},c.prototype.ek=function(){this.hierarchyExpanded=e.observableArray([]),this.isHierarchyExpanded=e.pureComputed((function(){return 0<this.hierarchyExpanded().length}),this),this.hierarchyExpansionLabel=e.computed((function(){return this.isHierarchyExpanded()?u("jraf.sidebar.collapseMenuTree"):u("jraf.sidebar.expandMenuTree")}),this),this.hierarchyExpansionIcon=e.computed((function(){var t="jraf-background-icon";return this.isHierarchyExpanded()?t+=" jraf-hierarchy-selection-collapse-icon":t+=" jraf-hierarchy-selection-expand-icon",t}),this)},c.prototype.rk=function(t){var i=this;this.searchPlaceholderText=u(t.searchPlaceholderText),this.noResultsText=u("jraf.messages.noResults"),this.autosuggestAdditionalResultsText=u(t.autosuggestAdditionalResultsText),this.searchString=e.observableArray([]),this.autosuggestOptionsKeys={children:"additionalResults"},this.autosuggestLabelsMap={},this.tk.getMenuDataLoaded().subscribe((function(t){if(t){var e=i.tk.getRootContent();e instanceof a&&(i.autosuggestLabelsMap={},i.uk(e,!0,"",i.autosuggestLabelsMap))}})),this.getAutosuggestOptions=function(t){return i.cb(t)},this.handleSearchSubmission=function(t){return i.fk(t)},this.searchInputPickerAttributes={class:"jraf-sidebar-search"}},c.prototype.uk=function(t,e,i,s){if(t.isLaunchable()){var a=t.getTitle(),n=r.isNonemptyString(i)?i:"";s[t.getId()]={label:a,path:n}}else if(t.isFolder()){e||(r.isNonemptyString(i)&&(i+=" / "),i+=t.getTitle());for(var o=t.getChildren(),h=0;h<o.length;h++)this.uk(o[h],!1,i,s)}},c.prototype.cb=function(t){var e=[];if(!r.isString(t.term))return Promise.resolve([]);var i=t.term,s=this.isHierarchyRoot(),a=s?this.tk.getRootContent():this.tk.getUIContent(this.drilledNode().id),n=[];if(this.ck(a,null,n),0<n.length){var o=this.lk(n,i);e=e.concat(o)}if(!s){var h=[];if(this.ck(this.tk.getRootContent(),a.getId(),h),0<h.length){var l=this.lk(h,i);0<l.length&&e.push({label:this.autosuggestAdditionalResultsText,additionalResults:l})}}return 0===e.length&&e.push({label:this.noResultsText}),Promise.resolve(e)},c.prototype.lk=function(t,e){for(var i=[],s=0;s<t.length;s++){var r=t[s],a=this.autosuggestLabelsMap[r].label,n=this.autosuggestLabelsMap[r].path,o=e.toLowerCase();(0<=a.toLowerCase().indexOf(o)||0<=n.toLowerCase().indexOf(o))&&i.push({value:r,label:a,path:n})}return i},c.prototype.ck=function(t,e,i){if(t.isFolder()&&t.getId()!==e)for(var s=t.getChildren(),r=0;r<s.length;r++)this.ck(s[r],e,i);t.isLaunchable()&&i.push(t.getId())},c.prototype.fk=function(e){var i=e.detail.value;if(!r.isNonemptyString(i))return!1;var s=i;t.Logger.info("UIShellTasksMenu._handleSearchSubmission: Content %s was selected.",s);var n=this.tk.getContent(s);return n instanceof a&&n.isLaunchable()&&(this.Rg(n),this.searchString.pop()),!0},c.prototype.yd=function(){if(!this.isHierarchyRoot()){var t=this.hierarchyDrillPath();this.ik(t[t.length-1].id)}},c.prototype.ik=function(t){for(var e=this.hierarchyDrillPath(),i=e.length-1;0<=i;i--){var s=e[i];if(this.Jj(),t===s.id)break}},c.prototype.hk=function(){1===this.hierarchyExpanded().length&&this.hierarchyExpanded.pop()},c.prototype.sk=function(){return i("#"+this.navListId)},c.prototype.Jj=function(){t.Logger.info("UIShellTasksMenu._navigateBack: Entering."),this.sk().find(".oj-navigationlist-previous-link").click()},c.prototype.Rg=function(t){n.openContent(t),n.closeMenu({closeOverlayMenuOnly:!0})},c}));