define(["jquery","ojs/ojcore","jraf/services/AbstractService","jraf/utils/UrlUtils","jraf/utils/ValidationUtils"],(function(e,t,r,s,a){"use strict";function i(e,t){i.superclass.constructor.apply(this,arguments),a.isObjectStrict(t)&&(this.Sc=t.clientAppCode),this.userData=null}return i.SERVICE_URL_PATH="services/private/RetailIdentityStore/",t.Object.createSubclass(i,r,"IdentityService"),i.prototype.executeLogin=function(t,r){var s=this,a=this.Ic("currentuser"),i=this.GetStandardHeaders();i.authorization="Basic "+btoa(t+":"+r);var n=e.ajax(a,{cache:!1,dataType:"json",xhrFields:{withCredentials:!0},headers:i});return new Promise((function(e,t){s.ConvertAjaxPromise(n).then((function(t){s.userData=t,e("success")}),(function(){s.userData=null,t("Invalid Credentials")}))}))},i.prototype.executeLogout=function(){var t=this,r=this.Ic("currentuser"),s=this.GetStandardHeaders();s.authorization="Basic "+btoa("invaliduser:invalidcredentials");var a=e.ajax(r,{dataType:"json",cache:!1,xhrFields:{withCredentials:!1},headers:s});return new Promise((function(e,r){t.ConvertAjaxPromise(a).then((function(){t.userData=null,e("logout success")}),(function(){t.userData=null,r("logout failed")}))}))},i.prototype.getUserData=function(){var t=this;if(null!==this.userData)return Promise.resolve(t.userData);var r=this.Ic("currentuser"),s=e.ajax(r,{cache:!1,dataType:"json",xhrFields:{withCredentials:!0},headers:this.GetStandardHeaders()});return new Promise((function(e,r){t.ConvertAjaxPromise(s).then((function(r){t.userData=r,e(t.userData)}),(function(){t.userData=null,r("Invalid Credentials")}))}))},i.prototype.searchUsers=function(t){if(!a.isString(t))throw new TypeError("IdentityService.searchUsers: Search users requires a string");var r=encodeURIComponent(t),s=this.Ic("searchusers?searchText="+r),i=e.ajax(s,{headers:this.GetStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0}});return this.ConvertAjaxPromise(i)},i.prototype.searchRoles=function(t){if(!a.isString(t))throw new TypeError("IdentityService.searchRoles: Search roles requires a string");var r=encodeURIComponent(t),s=this.Ic("searchroles?searchText="+r),i=e.ajax(s,{headers:this.GetStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0}});return this.ConvertAjaxPromise(i)},i.prototype.getCurrentUserRoles=function(){var t=this.Ic("currentuserroles"),r=e.ajax(t,{headers:this.GetStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0}});return this.ConvertAjaxPromise(r)},i.prototype.getRoles=function(t){var r="";if(t){var s=[];t.searchText&&s.push("searchText="+encodeURIComponent(t.searchText)),t.roleName&&s.push("roleName="+encodeURIComponent(t.roleName)),t.pageSize&&s.push("pageSize="+t.pageSize),t.pageNumber&&s.push("pageNumber="+t.pageNumber),t.sort&&s.push("sort="+encodeURIComponent(t.sort)),0<s.length&&(r+="?",r+=s.join("&"))}var a=this.Ic("roles"+r),i=e.ajax(a,{headers:this.GetStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0}});return this.ConvertAjaxPromise(i)},i.prototype.Ic=function(e){var t=this.BuildEndpoint(e,i.SERVICE_URL_PATH);return this.Sc&&(t=s.injectQueryParameter(t,"clientAppCode",this.Sc)),t},i}));