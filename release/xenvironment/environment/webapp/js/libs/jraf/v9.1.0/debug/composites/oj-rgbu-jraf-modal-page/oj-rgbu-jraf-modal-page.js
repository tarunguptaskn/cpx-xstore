define(["knockout","jquery","ojs/ojlogger","ojs/ojanimation","jraf/composites/utils/TranslationLoaderUtil","module","ojs/ojbutton","ojs/ojmoduleanimations","ojs/ojanimation","jraf/composites/oj-rgbu-jraf-apps-module/loader"],(function(e,t,o,n,i,s){"use strict";function a(t){this._context=t;var n=t.uniqueId;this.closeButtonId=n+"_closeButton",this.modalPageId=n+"_modalPage",this.appsModuleId=n+"_appsModule",this.pageClosed=e.observable(!0),this.pageDisplay=e.pureComputed((function(){return this.pageClosed()?"none":"block"}),this),this.pageContentModule=e.observable(),this.pageContentModuleOptions=e.observable(),this.renderPageContentModule=e.pureComputed((function(){return!this.pageClosed()&&(this.pageContentModule()||this.pageContentModuleOptions())}),this),this.headerClass=e.observable(""),this.headerClassString=e.pureComputed((function(){return"oj-flex-bar oj-sm-align-items-center oj-rgbu-jraf-modal-page-title-bar "+this.headerClass()}),this),this.bodyClass=e.observable(""),this.bodyClassString=e.pureComputed((function(){return"oj-flex-item oj-rgbu-jraf-modal-page-body "+this.bodyClass()}),this);var i=this;this.closeModalPage=function(){i.close().catch((function(){o.info("oj-rgbu-jraf-modal-page: modal page close was cancelled.")}))},this._loadingTranslations=a._translationLoader.getTranslations(),this._componentInitializing=Promise.all([this._loadingTranslations,t.properties]).then((function(e){i._initializeProperties(e[0],e[1])}))}return a._translationLoader=new i("oj-rgbu-jraf-modal-page",s.id),a.prototype.activated=function(){return this._componentInitializing},a.prototype.open=function(){this.previousActiveElement=document.activeElement;n.fadeIn(t("#"+this.modalPageId)[0],{duration:"250ms"}),this.pageClosed(!1),document.getElementById(this.closeButtonId).focus()},a.prototype.close=function(){if(!this._raiseBeforeClose())return Promise.reject();var e=this;return n.fadeOut(t("#"+this.modalPageId)[0],{duration:"250ms",persist:"all"}).then((function(){e._raiseClose(),e._restoreInitialState()}))},a.prototype._raiseBeforeClose=function(){return this._raiseCustomEvent("ojRgbuJrafModalPageBeforeClose",!0)},a.prototype._raiseClose=function(){this._raiseCustomEvent("ojRgbuJrafModalPageClose",!1)},a.prototype._raiseCustomEvent=function(e,t){var o={bubbles:!0,cancelable:t};return this._context.element.dispatchEvent(new CustomEvent(e,o))},a.prototype._restoreInitialState=function(){if(this.pageContentModule(void 0),this.pageContentModuleOptions(void 0),this.pageClosed(!0),this.previousActiveElement){try{this.previousActiveElement.focus()}catch(e){}this.previousActiveElement=void 0}},a.prototype._initializeProperties=function(e,t){this.closeLabel=e.close,["headerClass","bodyClass"].forEach((function(e){this._isNonemptyString(t[e])&&this[e](t[e])}),this),t.pageContentModule&&this.pageContentModule(t.pageContentModule),t.pageContentModuleOptions&&this.pageContentModuleOptions(t.pageContentModuleOptions)},a.prototype._attachEventListeners=function(){var e=this;t(this._context.element).on("keydown.oj-rgbu-jraf-modal-page",(function(t){e._keydownHandler(t)}))},a.prototype._isNonemptyString=function(e){return"string"==typeof e&&e.length>0},a.prototype._keydownHandler=function(e){!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE&&(e.preventDefault(),e.stopImmediatePropagation(),this.closeModalPage())},a.prototype.propertyChanged=function(e){var t=e.property;"external"!==e.updatedFrom||"pageContentModule"!==t&&"pageContentModuleOptions"!==t&&"headerClass"!==t&&"bodyClass"!==t||this[t](e.value)},a.prototype.connected=function(){this._attachEventListeners()},a.prototype.disconnected=function(){this._removeListeners()},a.prototype._removeListeners=function(){t(this._context.element).off("keydown.oj-rgbu-jraf-modal-page")},a.prototype.invokeModuleEventHandler=function(e,t,o){var n=document.getElementById(this.appsModuleId);if(n)return n.invokeModuleEventHandler(e,t,o)},a}));