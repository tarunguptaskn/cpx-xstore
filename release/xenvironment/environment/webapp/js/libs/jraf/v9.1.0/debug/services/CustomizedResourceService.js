define(["jquery","jraf/utils/UrlUtils","jraf/utils/ValidationUtils"],(function(e,t,r){"use strict";function i(e,t,o){if(!r.isNonemptyString(t))throw new TypeError("CustomizedResourceService requires a base uri.");if(r.isObjectStrict(e)?(this.appCode=e.appCode,this._clientAppCode=e.clientAppCode):this.appCode=e,!r.isNonemptyString(this.appCode))throw new TypeError("CustomizedResourceService requires an application code.");this.baseUri=t,this.pageSize=o||i.PAGE_SIZE}return i.PAGE_SIZE=1e3,i.SERVICE_URL_PATH="services/private/bundles/texts",i.SERVICE_VERSION="1.2.0",i.prototype._buildEndpoint=function(e){var r=this.baseUri;return"/"!==r.slice(-1)&&(r+="/"),r+=i.SERVICE_URL_PATH+e,this._clientAppCode&&(r=t.injectQueryParameter(r,"clientAppCode",this._clientAppCode)),r},i.prototype._getStandardHeaders=function(){return{"Accept-Version":i.SERVICE_VERSION,Accept:"application/json","Content-Type":"application/json"}},i.prototype._convertAjaxPromise=function(e){var t=this;return new Promise((function(r,i){e.done((function(){r.apply(this,arguments)})),e.fail((function(e,r,o){i(t._getFailureReason(e,o))}))}))},i.prototype._getFailureReason=function(e,t){if(!r.isObjectStrict(e)||!r.isNonemptyString(e.responseText))return t;var i,o=e.responseText;try{i=JSON.parse(o)}catch(e){window.console.log("Warning: _getFailureReason: responseText was not JSON.")}return r.isArray(i)&&r.isObjectStrict(i[0])&&r.isNonemptyString(i[0].message)?i[0].message:o},i.prototype.getCustomizedResources=function(e,t){this.currentResourceBundle=[];var r=e.replace(/^.*[\\\/]/,"");return this._getCustomizedResources(r,t,1)},i.prototype._getCustomizedResources=function(t,i,o){var n=this,s=this._buildEndpoint("?bundleName="+t+"&customized=true&pageSize="+this.pageSize+"&pageNumber="+o+"&languageTag="+("root"===i?"en":i)+"&appCode="+this.appCode),u=e.ajax(s,{headers:this._getStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0}});return this._convertAjaxPromise(u).then((function(e){if(r.isObjectStrict(e)){var o=n._parseBundle(e);return n.currentResourceBundle=n.currentResourceBundle.concat(o),e.totalPageCount>0&&e.totalPageCount!==e.currentPageNumber?n._getCustomizedResources(t,i,e.currentPageNumber+1):n.currentResourceBundle}return window.console.log("CustomizedResourceService._getCustomizedResources: Returned data not in expected format"),[]}))},i.prototype._parseBundle=function(e){for(var t=[],r=e.resourceTexts,i=0;i<r.length;i++)t.push({resourceKey:r[i].resourceKey,sourceText:r[i].customText});return t},i}));