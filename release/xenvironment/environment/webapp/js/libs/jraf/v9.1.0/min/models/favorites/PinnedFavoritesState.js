define(["ojs/ojcore","knockout","jraf/jrafcore","jraf/utils/ValidationUtils"],(function(t,e,n,i){"use strict";function r(){this.ju=e.observableArray([])}return r.ku=!1,r.pu="localPinSequence",r.favoriteIcons={task:"jraf-favorite-task-icon",report:"jraf-favorite-report-icon",document:"jraf-favorite-document-icon",user:"jraf-favorite-user-icon",unknown:"jraf-favorite-default-icon"},r.prototype.getPinnedObservable=function(t){return e.computed((function(){var e=t[r.pu]();return i.isNumberStrict(e)}))},r.prototype.updateState=function(t,e){if(t.isPinned()){var n=this.qu(t,e);n?n.favorite=t:this.Pu(t,e),this.Su()}else this.wu(t,e)},r.prototype.removeAllPins=function(t,e){var n=this;t&&t.forEach((function(t){n.wu(t,e),t.isFolder&&n.removeAllPins(t.children(),e)}))},r.prototype.qu=function(t,e){var n=this.bu(t,e);return this.lookupPinnedFavoriteById(n)},r.prototype.Pu=function(t,e){var n={pinnedFavoriteId:this.bu(t,e),favorite:t,favoriteHandlerKey:e};this.ju.push(n)},r.prototype.bu=function(t,e){return(i.isNonemptyString(e)?e:"local")+"."+t.entryId},r.prototype.Su=function(){this.ju.sort((function(t,e){var n=t.favorite[r.pu](),i=e.favorite[r.pu]();return n===i?0:n<i?-1:1}))},r.prototype.wu=function(t,e){var n=this.bu(t,e);this.ju.remove((function(t){return t.pinnedFavoriteId===n}))},r.prototype.pinFavorite=function(t,e){if(t.isPinned())return!1;var n=this.gu();return t[r.pu](n),this.Pu(t,e),!0},r.prototype.gu=function(){var t=this.ju.slice(-1)[0];return t?t.favorite[r.pu]()+1:1},r.prototype.unpinFavorite=function(t,e){return!(!t.isFolder&&!t.isPinned()||(t[r.pu](null),this.wu(t,e),0))},r.prototype.getPinnedFavorites=function(){return this.ju},r.prototype.lookupPinnedFavoriteById=function(t){return this.ju().filter((function(e){return e.pinnedFavoriteId===t}))[0]},r.getInstance=function(){var t=n.App.getUserData().userid;return t!==r.We&&(r.So=null,r.We=t),r.So instanceof r||(r.So=new r),r.So},r.manageGlobalPins=function(t){r.pu=(r.ku=t)?"globalPinSequence":"localPinSequence"},r.prototype.reorderPinnedFavorite=function(t,e,n,i,o){var u,a=this.lookupPinnedFavoriteById(t),p=this.lookupPinnedFavoriteById(n),s=this.yu(a.pinnedFavoriteId),f=this.yu(p.pinnedFavoriteId);if("after"===o&&f++,s===f)return!1;this.ju.splice(f,0,a),f<s?u=s+1:s<f&&(u=s),this.ju.splice(u,1);for(var c=0;c<this.ju().length;c++){var v=this.ju()[c].favorite;v[r.pu]()!==c+1&&i.push(v),v[r.pu](c+1)}return!0},r.prototype.yu=function(t){for(var e=0;e<this.ju().length;e++)if(t===this.ju()[e].pinnedFavoriteId)return e},r}));