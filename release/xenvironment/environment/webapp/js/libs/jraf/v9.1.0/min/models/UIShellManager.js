define(["ojs/ojcore","jraf/jrafcore","jquery","knockout","jraf/models/UIShellConfig","jraf/models/ContentManager","jraf/models/PopupManager","jraf/models/TabManager","jraf/models/MenuManager","jraf/models/RegionManager","jraf/models/ModalPageManager","jraf/controllers/PopupMenuManager","jraf/controllers/MobileMenuManager","jraf/models/ProcessingIndicatorManager","jraf/services/ServiceManager","jraf/models/Content","jraf/utils/ValidationUtils"],(function(e,n,r,t,o,a,g,i,s,l,u,c,M,h,f,p,d){"use strict";function P(n){if(e.Logger.info("UIShellManager: entering constructor function."),!(n instanceof o))throw new TypeError("UIShellManager: configuration must be UIShellConfig");this.Zl=n,this.$l=null,this.eg=null,this.ng=null,this.rg=r.Deferred(),this.ag=this.rg.promise(),this.tg=null,this.ig=r.Deferred(),this.og=this.ig.promise(),this.sg=null,this.lg=r.Deferred(),this.ug=this.lg.promise(),this.gg=null,this.fg=r.Deferred(),this.cg=this.fg.promise(),this.hg=null,this.Mg=this.Zl.getHeaderConfig().isRenderProcessingIndicator(),this.pg=r.Deferred(),this.dg=this.pg.promise(),this.wg=null,this.Ig=r.Deferred(),this.vg=this.Ig.promise(),this.bg=null,this.Sg={},this.Ug={};var t=this.Zl.getNavigationConfig();d.isFunction(t.getBeforeOpenContentHandler())?this.Nu=t.getBeforeOpenContentHandler():this.Nu=function(e){return Promise.resolve(e)}}return"object"!=typeof n.Eg&&(n.Eg={}),P.registerDataPromise=function(e,n){if(!(d.isNonemptyString(e)&&n instanceof Promise))throw new TypeError("UIShellManager.registerDataPromise: Invalid input.");P.Pg().Ug[e]=n},P.getDataPromise=function(e){return P.Pg().Ug[e]},P.openContent=function(e){return P.yg(e)},P.openModalPageInContent=function(e,n){if(!e.isContextualModalPageContent())throw new TypeError("UIShellManager.openModalPageInContent: modalPageContent must target a contextual modal page.");if(!n.isMainAreaContent())throw new TypeError("UIShellManager.openModalPageInContent: parentContent must target the main area.");return P.yg(e,n)},P.yg=function(e,n){var r=P.Pg();return Promise.all([r.ag,r.vg]).then((function(){return P.startProcessingIndicator(),r.mg(e,n)}))},P.prototype.mg=function(e,n){var r=this,t=[this.Nu(e)];return n instanceof p&&t.push(this.Nu(n)),Promise.all(t).then((function(e){if(2===e.length){var n=e[0],t=e[1],o=n instanceof p,a=t instanceof p;if(a&&t.isMainAreaContent()&&o&&n.isContextualModalPageContent())return r.Rg(t,n);if(!a&&r.Tg(e[1]))return P.stopProcessingIndicator(),r.go(e[1]);throw P.stopProcessingIndicator(),new TypeError("UIShellManager._invokeBeforeOpenContentHandler: beforeOpenContentHandler returned unsupported scenario on UIShellManager.openModalPageInContent call.")}var g=e[0];if(g instanceof p)return r.Rg(g);if(r.Tg(g))return P.stopProcessingIndicator(),r.go(g);throw P.stopProcessingIndicator(),new TypeError("UIShellManager._invokeBeforeOpenContentHandler: Callback did not return a Content object or toast configuration.")}),(function(e){throw P.stopProcessingIndicator(),new TypeError("UIShellManager._invokeBeforeOpenContentHandler: Handler rejected with reason ("+e+").")}))},P.prototype.Tg=function(e){return d.isObjectStrict(e)&&d.isNonemptyString(e.severity)},P.prototype.Rg=function(n,r){var t=r instanceof p,o=[Promise.resolve(!0)],a=f.getAccessControlService();a&&d.isFunction(a.hasAccess)&&(o[0]=a.hasAccess(n),t&&o.push(a.hasAccess(r)));var g=this;return Promise.all(o).then((function(e){if(e[0]){if(t){var o=e[1]?r:g.jg(r);g.tg.openModalPageInContent(o,n)}else g.tg.openContent(n);P.stopProcessingIndicator()}else g.Cg(n,!0)}),(function(r){e.Logger.warn("UIShellManager._openContent: Error checking access to content (%s)",r),g.Cg(n,!0)}))},P.closeContent=function(e){var n=P.Pg();return n.ag.then((function(){n.tg.closeContent(e)}))},P.openModuleAsDialog=function(e,n,r,t){var o=p.createDialogContent(e,n,r,t);this.openContent(o)},P.openModuleInDialog=function(e,n,r,t){var o=p.createModuleDialogContent(e,n,r,t);this.openContent(o)},P.openModuleAsTab=function(e,n){var r=p.createTabContent(e,n);this.openContent(r)},P.openModuleInTab=function(e,n){var r=p.createModuleTabContent(e,n);this.openContent(r)},P.openUrlAsTab=function(e,n,r,t){var o=p.createUrlTabContent(e,n,r,t);this.openContent(o)},P.closeContentDialog=function(){var e=P.Pg();return e.ag.then((function(){return e.tg.closePopup()}))},P.closeGlobalModalPage=function(){var e=P.Pg();return e.ag.then((function(){return e.tg.closeGlobalModalPage()}))},P.prototype.Cg=function(e,n){var r=this.jg(e),t=this;this.ag.then((function(){t.tg.openContent(r),n&&P.stopProcessingIndicator()}))},P.prototype.jg=function(e){var n=r.extend({},e.targetProperties,{showCloseIcon:!0,removable:!0});return n.targetType===p.CONTENT_TARGET_WINDOW&&(n.targetType=p.CONTENT_TARGET_MAIN_AREA),new p({title:e.getTitle(),targetProperties:n,resourceType:p.CONTENT_TYPE_MODULE,moduleBinding:{name:"jraf/UIShellAccessDenied"}})},P.openToast=function(e){var n=P.Pg();return n.vg.then((function(){return n.go(e)}))},P.prototype.go=function(e){var n=document.getElementById(this.bg);if(n)return n.openToast(e)},P.isRenderProcessingIndicator=function(){return P.Pg().Mg},P.startProcessingIndicator=function(){var e=P.Pg();e.Mg&&e.dg.then((function(){e.wg.startProcessing()}))},P.stopProcessingIndicator=function(){var e=P.Pg();e.Mg&&e.dg.then((function(){e.wg.stopProcessing()}))},P.pinMenu=function(e){return"object"==typeof e&&null!==e||(e={}),e.displayMode=s.DISPLAY_MODE_PIN,P.openMenu(e)},P.overlayMenu=function(e){return"object"==typeof e&&null!==e||(e={}),e.displayMode=s.DISPLAY_MODE_OVERLAY,P.openMenu(e)},P.openMenu=function(n){if(e.Logger.info("UIShellManager.openMenu: Entering."),"object"!=typeof n||null===n||"string"!=typeof n.displayMode)throw new TypeError("UIShellManager.openMenu: Invalid menuConfig.");var r={displayMode:n.displayMode};"string"==typeof n.menuItemId&&0<n.menuItemId.length&&(r.menuItemId=n.menuItemId);var t=P.Pg();return new Promise((function(e,n){t.og.then((function(){t.sg.openMenu(r).then((function(n){e(n)})).catch((function(e){n(e)}))}))}))},P.closeMenu=function(n){e.Logger.info("UIShellManager.closeMenu: Entering.");var r=P.Pg();return r.hg&&P.closeMobileNavMenu(),new Promise((function(e,t){r.og.then((function(){r.sg.closeMenu(n).then((function(n){e(n)})).catch((function(e){t(e)}))}))}))},P.ResetMenu=function(){e.Logger.info("UIShellManager.ResetMenu: Entering.");var n=P.Pg();return n.og.then((function(){n.sg.resetMenu()}))},P.openPopupMenu=function(n){e.Logger.info("UIShellManager.openPopupMenu: Entering.");var r=P.Pg();return r.ug.then((function(){r.gg.openMenu(n)}))},P.closePopupMenu=function(){e.Logger.info("UIShellManager.closePopupMenu: Entering.");var n=P.Pg();return n.hg&&P.closeMobileNavMenu(),n.ug.then((function(){n.gg.closeMenu()}))},P.ResetPopupMenu=function(){e.Logger.info("UIShellManager.ResetPopupMenu: Entering.");var n=P.Pg();return n.ug.then((function(){n.gg.resetMenu()}))},P.closeMobileNavMenu=function(){e.Logger.info("UIShellManager.closeMobileNavMenu: Entering.");var n=P.Pg();return n.cg.then((function(){return n.hg.closeNavMenu()}))},P.closeMobileOptionsMenu=function(){e.Logger.info("UIShellManager.closeMobileOptionsMenu: Entering.");var n=P.Pg();return n.cg.then((function(){return n.hg.closeOptionsMenu()}))},P.closeAllMenus=function(n){e.Logger.info("UIShellManager.closeAllMenus: Entering.");var r=P.Pg(),t=[];return r.sg&&t.push(r.sg.closeMenu(n)),r.gg&&t.push(r.gg.closeMenu()),r.hg&&(t.push(r.hg.closeNavMenu()),t.push(r.hg.closeOptionsMenu())),Promise.all(t)},P.registerCallback=function(e,n){var r=P.Pg();r&&(r.Sg[e]=n)},P.prototype._g=function(n){e.Logger.info("UIShellManager._registerComponent: registering "+n+"."),this.eg instanceof g&&(this.$l instanceof i||this.ng instanceof l)&&this.kg instanceof u&&null===this.tg&&(this.tg=new a({tabManager:this.$l,regionManager:this.ng,popupManager:this.eg,globalModalPageManager:this.kg}),this.rg.resolve())},P.RegisterPopupManager=function(e){var n=P.Pg();if(this.eg instanceof g)throw new Error("UIShellManager.RegisterPopupManager: PopupManager has already been registered.");if(!(e instanceof g))throw new TypeError("UIShellManager.RegisterPopupManager: popupManager must be a PopupManager.");n.eg=e,n._g("_popupManagerRegistered")},P.RegisterGlobalModalPageManager=function(e){var n=P.Pg();if(this.kg instanceof u)throw new Error("UIShellManager.RegisterGlobalModalPageManager: ModalPageManager has already been registered.");if(!(e instanceof u))throw new TypeError("UIShellManager.RegisterGlobalModalPageManager: modalPageManager must be a ModalPageManager.");n.kg=e,n._g("_globalModalPageManagerRegistered")},P.RegisterGlobalToasterId=function(e){var n=P.Pg();if(d.isNonemptyString(n.bg))throw new Error("UIShellManager.RegisterGlobalToasterId: globalToasterId has already been registered.");if(!d.isNonemptyString(e))throw new TypeError("UIShellManager.RegisterGlobalToasterId: globalToasterId must be a non-empty string.");n.bg=e,n.Ig.resolve()},P.RegisterTabManager=function(e){var n=P.Pg();if(this.$l instanceof i)throw new Error("UIShellManager.RegisterTabManager: TabManager has already been registered.");if(!(e instanceof i))throw new TypeError("UIShellManager.RegisterTabManager: tabManager must be a TabManager.");n.$l=e,n._g("_tabManagerRegistered")},P.RegisterRegionManager=function(e){var n=P.Pg();if(this.ng instanceof l)throw new Error("UIShellManager.RegisterRegionManager: RegionManager has already been registered.");if(!(e instanceof l))throw new TypeError("UIShellManager.RegisterRegionManager: regionManager must be a RegionManager.");n.ng=e,n._g("_regionManagerRegistered")},P.RegisterMenuManager=function(n){e.Logger.info("UIShellManager.RegisterMenuManager: Entering.");var r=P.Pg();if(r.sg instanceof s)throw new Error("UIShellManager.RegisterMenuManager: A MenuManager has already been registered.");if(!(n instanceof s))throw new TypeError("UIShellManager.RegisterMenuManager: Invalid type for MenuManager.");r.sg=n,r.ig.resolve()},P.RegisterPopupMenuManager=function(n){e.Logger.info("UIShellManager.RegisterMenuManager: Entering.");var r=P.Pg();if(r.gg instanceof c)throw new Error("UIShellManager.RegisterPopupMenuManager: A PopupMenuManager has already been registered.");if(!(n instanceof c))throw new TypeError("UIShellManager.RegisterPopupMenuManager: Invalid type for PopupMenuManager.");r.gg=n,r.lg.resolve()},P.RegisterMobileMenuManager=function(n){e.Logger.info("UIShellManager.RegisterMobileMenuManager: Entering.");var r=P.Pg();if(r.hg instanceof M)throw new Error("UIShellManager.RegisterMobileMenuManager: A MobileMenuManager has already been registered.");if(!(n instanceof M))throw new TypeError("UIShellManager.RegisterMobileMenuManager: Invalid type for MobileMenuManager.");r.hg=n,r.fg.resolve()},P.RegisterProcessingIndicatorManager=function(e){var n=P.Pg();if(n.wg)throw new Error("UIShellManager.RegisterProcessingIndicatorManager: ProcessingIndicatorManager has already been registered.");if(!(e instanceof h))throw new TypeError("UIShellManager.RegisterProcessingIndicatorManager: processingIndicatorManager must be a ProcessingIndicatorManager.");n.wg=e,n.pg.resolve()},P.ActivateNewManager=function(r){e.Logger.info("UIShellManager.ActivateNewManager: Entering."),n.Eg.activeInstance=new P(r)},P.Pg=function(){if(!n.Eg.activeInstance)throw new Error("UIShellManager has not been properly initialized.");return n.Eg.activeInstance},P.getMenuDrawerState=function(){var e=this.Pg();if(!e.sg&&!e.hg)throw new Error("Neither MenuManager nor MobileMenuManager instances have been initialized.");return t.pureComputed((function(){var n=!!e.sg&&e.sg.menuOpened(),r=!!e.hg&&e.hg.getNavMenuStateTracker();return t.unwrap(n)||t.unwrap(r)}))},P.getPopupMenuState=function(){var e=this.Pg();if(!e.gg)throw new Error("PopupMenuManager instance has not been initialized.");return e.gg.getMenuState()},P}));