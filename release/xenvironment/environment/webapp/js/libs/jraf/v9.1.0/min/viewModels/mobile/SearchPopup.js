define(["ojs/ojcore","knockout","jraf/jrafcore","jraf/models/UIShellManager","jraf/models/Content","jraf/utils/ValidationUtils","ojs/ojarraydataprovider","ojs/ojinputtext","ojs/ojselectsingle","ojs/ojlistview","ojs/ojknockout"],(function(e,t,a,r,l,s,i){"use strict";var n=e.Translations.getTranslatedString;function o(e){if(!(s.isObjectStrict(e)&&s.isFunction(e.searchCallback)&&s.isFunction(e.searchSectionFilterCallback)&&s.isFunction(e.searchContextCallback)&&s.isFunction(e.closeSearchCallback)))throw new TypeError("SearchPopup: Missing required parameters");this.sectionFilterInputId=a.UIShell.generateUniqueId(),this.searchInputId=a.UIShell.generateUniqueId(),this.mobileSearchResultTemplateId=a.UIShell.generateUniqueId(),this.searchSectionFilterCallback=e.searchSectionFilterCallback,this.searchCallback=e.searchCallback,this.searchContextCallback=e.searchContextCallback,this.closeSearchCallback=e.closeSearchCallback,this.searchPlaceholderText=n("jraf.global.searchPlaceholderText"),this.noResultsLabel=n("jraf.messages.noResults"),this.closeSearchLabel=n("jraf.global.deactivateGlobalSearchAriaLabel"),this.searchFilterComponentLabel=n("jraf.global.searchFilterComponentLabel"),this.Pj(),this.Bt()}return o.DEFAULT_FILTER_SECTION={value:-1,label:n("jraf.global.searchDefaultFilterLabel")},o.prototype.Pj=function(){var e=this;this.searchString=t.observableArray([]),this.searchResults=t.observableArray([]),this.hasSearchResults=t.pureComputed((function(){return 0<this.searchResults().length}),this),this.searchOptionChange=function(t,a){e.Rj(t,a)},this.launchSearchResult=function(t){e.Nj(t.value)}},o.prototype.Bt=function(){this.sectionFilterSelection=t.observableArray([o.DEFAULT_FILTER_SECTION.value]),this.sectionFilters=t.observableArray([{value:o.DEFAULT_FILTER_SECTION.value,label:o.DEFAULT_FILTER_SECTION.label}]),this.sectionFiltersDataProvider=new i(this.sectionFilters,{keyAttributes:"value"}),this.Qj()},o.prototype.Qj=function(){var t=this;return this.searchSectionFilterCallback().then((function(e){t.sectionFilters(t.Wj(e))}),(function(t){e.Logger.warn("SearchPopup._getSectionFilterOptions: Error loading sections: ",t)}))},o.prototype.Wj=function(e){var t=[];t.push({value:o.DEFAULT_FILTER_SECTION.value,label:o.DEFAULT_FILTER_SECTION.label});for(var a=0;a<e.length;a++){var r=e[a];t.push({value:r.value,label:""+r.label})}return t},o.prototype.Rj=function(e,t){if("rawValueChanged"===e.type){var a=e.detail.value;s.isNonemptyString(a)?this.Xj(a):this.searchResults([])}},o.prototype.Xj=function(t){var a=this,r=this.Yj(t);return this.searchCallback(r).then((function(e){a.searchResults(a.Zj(e))}),(function(t){e.Logger.warn("SearchPopup._executeSearch: Error running search: ",t)}))},o.prototype.Yj=function(e){var t=this.sectionFilterSelection()[0],a={searchText:e};return t!==o.DEFAULT_FILTER_SECTION.value&&(a.sectionId=t),a},o.prototype.Zj=function(e){for(var t=[],a={},r=0;r<e.length;r++){var l=e[r];t.push({value:""+l.value,label:l.label,metadata:l.metadata||""}),a[l.label]=void 0===a[l.label]}for(var s=0;s<t.length;s++){var i=t[s];a[i.label]||(i.label=i.label+" "+i.value)}return t},o.prototype.Nj=function(e){var t=this;return this.searchContextCallback(e).then((function(e){var a=new l(e);a&&(r.openContent(a),t.searchString([""]),t.closeSearchCallback())}))},o}));