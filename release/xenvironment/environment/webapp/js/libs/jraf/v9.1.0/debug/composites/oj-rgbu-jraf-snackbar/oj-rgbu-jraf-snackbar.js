define(["knockout","jquery","ojs/ojtranslation","ojs/ojlogger","jraf/utils/ValidationUtils","jraf/composites/utils/TranslationLoaderUtil","module","ojs/ojanimation"],(function(t,e,i,n,s,a,o){"use strict";var r=i.getTranslatedString;function c(e){var i=this,n=e.uniqueId;this.snackbarAnchorId=n+"_anchor",this.dialogId=n+"_dialog",this.dialogHeaderId=n+"_dialogHeader",this.loadingTranslations=c._translationLoader.getTranslations(),this.activeSnack=t.observable(null),this._snackQueue=[],this._snackSequencer=Promise.resolve(),this._idCounter=0,this.firePrimary=function(){i._firePrimaryAction()},this.fireSecondary=function(){i._fireSecondaryAction()},this.handleDialogClose=function(){i._handleDialogClose()},this.closeDialog=function(){i._closeDialog()},this.showAllMessages=function(){i._showAllMessages()},this.componentInitializing=this.loadingTranslations.then((function(t){i.translations=t}))}return c.LEVEL_INFO="info",c.LEVEL_WARNING="warning",c.LEVEL_ERROR="error",c.LEVEL_SUCCESS="success",c.ANIMATION_CLASS="oj-rgbu-jraf-snackbar-animating",c.ACTIVE_CLASS="oj-rgbu-jraf-snackbar-active",c.ANIMATION_EXIT_CLASS="oj-rgbu-jraf-snackbar-animate-exit",c.ANIMATION_DURATION=500,c.DEFAULT_DISMISS_TIMEOUT=3e3,c._defaultTimeout=c.DEFAULT_DISMISS_TIMEOUT,c.STATUS_EVENT_TYPE="ojRgbuJrafSnackbarStatus",c._translationLoader=new a("oj-rgbu-jraf-snackbar",o.id),c.prototype.activated=function(){return this.componentInitializing},c.prototype.disconnected=function(){window.clearTimeout(this._timeoutId)},c.prototype.openSnack=function(t){var e=this._parseSnack(t);return this._queueSnack(e),e._id},c.prototype._parseSnack=function(t){if(!s.isObjectStrict(t)||!s.isNonemptyString(t.message)&&!s.isArray(t.messageList)||!s.isNonemptyString(t.severity))throw new TypeError("Snackbar._parseSnack: Missing required parameters");var e=this._getSeverityIcon(t.severity),i={_id:this._getNextId(),message:t.message,severity:t.severity,severityIcon:"oj-rgbu-jraf-snackbar-snack-icon "+e,dialogHeaderSeverityIcon:"oj-rgbu-jraf-snackbar-snack-header-icon "+e,severityLabel:this._getSeverityLabel(t.severity),_disableTimeout:s.getBoolean(t.disableTimeout,!1),_dismissTimeout:s.isNumber(t.timeout)?+t.timeout:c._defaultTimeout,hasMultipleMessages:!1};return s.isArray(t.messageList)&&(i.messageList=t.messageList,i.hasMultipleMessages=!0,i.message||(i.message=this._getBulkMessageLabel(t)),i.dialogDismissBehavior=i._disableTimeout?"none":"icon"),this._initializeButtons(i,t),i},c.prototype._getNextId=function(){return this._idCounter++},c.prototype._getSeverityIcon=function(t){return t===c.LEVEL_INFO?"oj-rgbu-jraf-snackbar-snack-info":t===c.LEVEL_WARNING?"oj-rgbu-jraf-snackbar-snack-warning":t===c.LEVEL_ERROR?"oj-rgbu-jraf-snackbar-snack-error":t===c.LEVEL_SUCCESS?"oj-rgbu-jraf-snackbar-snack-success":(n.warn("Snackbar._getSeverityIcon: Invalid level "+t),"")},c.prototype._getSeverityLabel=function(t){return t===c.LEVEL_INFO?this.translations.info:t===c.LEVEL_WARNING?this.translations.warning:t===c.LEVEL_ERROR?this.translations.error:t===c.LEVEL_SUCCESS?this.translations.success:(n.warn("Snackbar._getSeverityLabel: Invalid level "+t),null)},c.prototype._getBulkMessageLabel=function(t){var e=t.severity,s="",a=t.messageList.length;return e===c.LEVEL_INFO?s=this.translations.bulkMessage.info:e===c.LEVEL_WARNING?s=this.translations.bulkMessage.warning:e===c.LEVEL_ERROR?s=this.translations.bulkMessage.error:e===c.LEVEL_SUCCESS?s=this.translations.bulkMessage.success:n.warn("Snackbar._getBulkMessageLabel: Invalid level "+e),i.applyParameters(s,[a])},c.prototype._initializeButtons=function(t,e){var i=this,n=s.getBoolean(e.showDismiss,!1),a=e.primaryButton,o=e.secondaryButton;if(n&&(a={label:this.translations.dismiss,callback:function(){i.closeSnack(t._id)}}),!s.isObjectStrict(o)||s.isObjectStrict(a)||n||(a=o,o=null),t._disableTimeout&&!a)throw new TypeError("Snackbar._initializeButtons: Must have a button to declare dismiss only");a&&(t.primaryButton=this._parseButton(a)),o&&(t.secondaryButton=this._parseButton(o))},c.prototype._parseButton=function(t){var e=r(t.label),i=t.callback;if(s.isNonemptyString(e)&&s.isFunction(i))return{label:e,callback:i};throw new TypeError("Snackbar._parseButton: Invalid button params:\n "+JSON.stringify(t))},c.prototype._queueSnack=function(t){var e=this;this._snackSequencer=this._snackSequencer.then((function(){if(e._snackQueue.push(t),!e.activeSnack())return e._showNextSnack()}))},c.prototype._showNextSnack=function(){var t=this,e=this._snackQueue.shift();return this.activeSnack(e),this._fireStatusEvent(e.severity),this._animateEntrance().then((function(){t._engageTimeout(e)}))},c.prototype._engageTimeout=function(t){var e=this;this._timeoutId&&window.clearTimeout(this._timeoutId),t._disableTimeout||(this._timeoutId=window.setTimeout((function(){e.closeSnack(t._id)}),t._dismissTimeout))},c.prototype.closeSnack=function(t){var e=this;this._isClosing||!this.activeSnack()||void 0!==t&&t!==this.activeSnack()._id||(this._isClosing=!0,this._snackSequencer=this._snackSequencer.then((function(){return e._closeDialog(),e._fireStatusEvent(null),e._animateExit()})).then((function(){if(e.activeSnack(null),e._isClosing=!1,e._snackQueue.length>0)return e._showNextSnack()})))},c.prototype._fireStatusEvent=function(t){var e=document.getElementById(this.snackbarAnchorId),i=new CustomEvent(c.STATUS_EVENT_TYPE,{detail:t,bubbles:!0});e.dispatchEvent(i)},c.prototype._firePrimaryAction=function(){var t=this.activeSnack().primaryButton;this._executeButtonCallback(t.callback)},c.prototype._fireSecondaryAction=function(){var t=this.activeSnack().secondaryButton;this._executeButtonCallback(t.callback)},c.prototype._executeButtonCallback=function(t){var e=this.activeSnack()._id;t(),this.closeSnack(e)},c.prototype._animateEntrance=function(){var t=document.getElementById(this.snackbarAnchorId);return t.classList.add(c.ACTIVE_CLASS),t.classList.add(c.ANIMATION_CLASS),new Promise((function(e){window.setTimeout((function(){t.classList.remove(c.ANIMATION_CLASS),e()}),c.ANIMATION_DURATION)}))},c.prototype._animateExit=function(){var t=this,e=document.getElementById(this.snackbarAnchorId);return e.classList.remove(c.ACTIVE_CLASS),e.classList.add(c.ANIMATION_CLASS),e.classList.add(c.ANIMATION_EXIT_CLASS),new Promise((function(e){window.setTimeout((function(){t._cleanupAnimation().then(e)}),c.ANIMATION_DURATION)}))},c.prototype._cleanupAnimation=function(){var t=document.getElementById(this.snackbarAnchorId);return t.classList.remove(c.ANIMATION_CLASS),t.classList.remove(c.ANIMATION_EXIT_CLASS),new Promise((function(t){window.setTimeout(t,50)}))},c.prototype._closeDialog=function(){document.getElementById(this.dialogId).close()},c.prototype._showAllMessages=function(){this._timeoutId&&window.clearTimeout(this._timeoutId),this.dialogSnackId=this.activeSnack()._id,document.getElementById(this.dialogId).open()},c.prototype._handleDialogClose=function(){this.closeSnack(this.dialogSnackId)},c.setDefaultDismissTime=function(t){if(!(s.isNumber(t)&&+t>0))throw new TypeError("Snackbar.setDefaultDismissTime: Timeout must be a positive number");c._defaultTimeout=t},c}));