define(["jquery","ojs/ojcore","knockout","jraf/utils/ValidationUtils"],(function(e,t,r,n){"use strict";function i(){this.me=i.LIGHT_THEME.id,this.Te=r.observable(this.me),this.ge=r.observable(!1),this.Te.subscribe((function(e){this.ke(e)}),this)}return i.THEME_SUFFIX="_theme",i.LOCAL_THEME_KEY="jraf.userTheme",i.DARK_THEME={id:"dark",label:"jraf.global.darkThemeLabel"},i.LIGHT_THEME={id:"light",label:"jraf.global.lightThemeLabel"},i.prototype.we=function(e){n.isBoolean(e)&&this.ge(e)},i.prototype.isUserConfigurable=function(){return this.ge},i.prototype.Ue=function(e){this.be(e)?this.me=e:t.Logger.warn("ThemeManager.setDefaultTheme: Unknown theme "+e+" provided")},i.prototype.setTheme=function(e){this.be(e)?(this.Te(e),window.localStorage.setItem(i.LOCAL_THEME_KEY,e)):t.Logger.warn("ThemeManager.setTheme: Unknown theme "+e+" provided")},i.prototype.loadSavedTheme=function(){var e=window.localStorage.getItem(i.LOCAL_THEME_KEY);e&&this.setTheme(e)},i.prototype.be=function(e){var t=this.getAvailableThemes();for(var r in t)if(t[r].id===e)return!0;return!1},i.prototype.getTheme=function(){return this.Te},i.prototype.resetTheme=function(){this.Te(this.me)},i.prototype.getAvailableThemes=function(){return[i.LIGHT_THEME,i.DARK_THEME]},i.prototype.ke=function(t){var r=this;e("link.jraf-update-url-theme").each((function(){r.Le(e(this),t)}))},i.prototype.Le=function(e,t){if(e){var r=e.attr("href"),n=this.Me(r,t);e.attr({href:n})}},i.prototype.Me=function(e,r){if(!e)return t.Logger.warn("ThemeManager._updateURLTheme: No URL provided"),e;var n="",i=e.split("/").pop(),o=i.indexOf(".");0<=o&&(n=i.substring(o));var a=e.substring(0,e.length-i.length),h=i.substring(0,i.length-n.length).split("-"),s=this.Re(h);return 0<=s?(h[s]=r,a+h.join("-")+n):(t.Logger.warn("ThemeManager._updateURLTheme: URL "+e+" is not a valid theme file"),e)},i.prototype.Re=function(e){for(var t=e.length-1;0<=t&&t>=e.length-2;t--){var r=e[t];if(this.be(r))return t}return-1},i.configure=function(e){var t=i.getInstance();t.Ue(e.defaultTheme),t.we(e.userConfigurable),t.resetTheme(),t.loadSavedTheme()},i.getInstance=function(){return i._e||(i._e=new i),i._e},i}));