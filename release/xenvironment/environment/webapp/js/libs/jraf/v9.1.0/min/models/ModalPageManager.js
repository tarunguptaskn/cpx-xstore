define(["ojs/ojcore","jquery","knockout","jraf/jrafcore","jraf/models/Content","jraf/utils/ValidationUtils"],(function(e,t,o,n,l,r){"use strict";function a(e){if(!r.isObjectStrict(e)||!r.isNonemptyString(e.modalPageContainerId))throw new TypeError("ModalPageManager: Missing required parameters");this.dl=e.modalPageContainerId,this.ul=e.beforeLoadModuleHandler,this.fl=e.afterUnloadModuleHandler,this.cl=[]}return a.prototype.openContent=function(e){if(!(e instanceof l))throw new TypeError("ModalPageManager.openContent: Invalid content passed");t("#"+this.dl).addClass("jraf-modal-page-container");var n=this.gl(e),r=n.id,a=this.ml(r,e.isFillContentArea());return this.cl.push({id:r,viewModel:n,element:a,closing:!1}),document.getElementById(this.dl).appendChild(a),o.applyBindings(n,document.getElementById(r)),this.Ml(r)},a.prototype.Ml=function(t){return e.Context.getContext(document.getElementById(t)).getBusyContext().whenReady().then((function(){return document.getElementById(t).open()}))},a.prototype.gl=function(e){var t=this;return{id:n.UIShell.generateUniqueId(),title:e.getTargetTitle(),moduleBinding:this.pl(e),moduleOptions:this.vl(e),handleBeforeClose:function(e,o){return t.kn(e,o)},handleClose:function(e,o){return t.Hn(e,o)},handleBeforeLoadModule:this.ul,handleAfterUnloadModule:this.fl}},a.prototype.pl=function(e){if(!e.hasModuleOptions()){var o=e.getModuleBinding();return t.extend(!0,{},o,{params:{jraf:{modalPageManager:this}}})}},a.prototype.vl=function(e){if(e.hasModuleOptions()){var o=e.getModuleOptions();return t.extend(!0,{},o,{params:{jraf:{modalPageManager:this}}})}},a.prototype.ml=function(e,t){var o=document.createElement("oj-rgbu-jraf-modal-page");return o.setAttribute("id",e),o.setAttribute("page-title","[[title]]"),o.setAttribute("page-content-module","[[moduleBinding]]"),o.setAttribute("page-content-module-options","[[moduleOptions]]"),o.setAttribute("on-oj-rgbu-jraf-modal-page-before-close","[[handleBeforeClose]]"),o.setAttribute("on-oj-rgbu-jraf-modal-page-close","[[handleClose]]"),o.setAttribute("before-load-module-handler","[[handleBeforeLoadModule]]"),o.setAttribute("after-unload-module-handler","[[handleAfterUnloadModule]]"),o.setAttribute("data-oj-context",""),t&&o.setAttribute("body-class","jraf-modal-page-fill-content-area"),o},a.prototype.closeContent=function(){var e=this.jl();if(null===e)throw new Error("ModalPageManager.closeContent: No modal pages to close.");return this.Cl(e)},a.prototype.jl=function(){for(var e=null,t=this.cl.length;0<t;t--){var o=this.cl[t-1];if(!o.closing){e=o;break}}return e},a.prototype.Cl=function(t){var o=t.id;return e.Logger.info("ModalPageManager._closeModalPage: Closing modal page %s.",o),t.closing=!0,document.getElementById(o).close()},a.prototype.Pl=function(e){var t=this.cl.filter((function(t){return t.id===e}));return 1===t.length?t[0]:null},a.prototype.kn=function(t,o){var n=t.target.id;return e.Logger.info("ModalPageManager._handleBeforeClose: Handling modal page beforeClose event (%s).",n),!1!==this.bl("uiShellBeforeClose",t,o,n)||(this.Pl(n).closing=!1,t.preventDefault(),!1)},a.prototype.Hn=function(t,o){var n=t.target.id;e.Logger.info("ModalPageManager._handleClose: Handling modal page close event (%s).",n),this.bl("uiShellClose",t,o,n);var l=this;e.Context.getContext(document.getElementById(n)).getBusyContext().whenReady().then((function(){l.Bl(n)}))},a.prototype.Bl=function(t){e.Logger.info("ModalPageManager._cleanupModalPage: Cleaning up %s.",t),o.removeNode(document.getElementById(t)),this.wl(t)},a.prototype.wl=function(t){for(var o=-1,n=0;n<this.cl.length;n++)if(this.cl[n].id===t){o=n;break}-1!==o?this.cl.splice(o,1):e.Logger.warn("ModalPageManager._cleanupModalPageState: Did not find state for modal page %s.",t)},a.prototype.dispose=function(){var e=this;t("#"+this.dl).children().each((function(t,o){e.Bl(o.id)}))},a.prototype.bl=function(e,t,o,n){return document.getElementById(n).invokeModuleEventHandler(e,t,o)},a.prototype.handleBeforeCloseAll=function(t,o){for(var n=this.cl.length-1;0<=n;n--){var l=this.cl[n].id;if(e.Logger.info("ModalPageManager.handleBeforeCloseAll: Handling modal page beforeClose event (%s).",l),!1===this.bl("uiShellBeforeClose",t,o,l))return!1}return!0},a}));