define(["knockout","ojs/ojcore","jquery","jraf/utils/I18nUtils","jraf/utils/ValidationUtils","jraf/services/ServiceManager","ojs/ojcorerouter"],(function(e,t,p,r,a,n,i){"use strict";var o={};"undefined"!=typeof window&&(o=window);var A=o.jraf={version:"9.1.0",build:"",revision:""};A.UIShell={},A.UIShell.TASKS_DATA_LOAD_ID="jraf.tasks",A.UIShell.REPORTS_DATA_LOAD_ID="jraf.reports",A.UIShell.SETTINGS_DATA_LOAD_ID="jraf.settings",A.UIShell.LAUNCHABLE_DATA_LOAD_ID="jraf.launchable";var u=0;A.UIShell.generateUniqueId=function(){return"jraf-ui-id-"+ ++u};var s=[];return A.UIShell.registerPollingId=function(e){0<=s.indexOf(e)||s.push(e)},A.UIShell.clearPollingId=function(e){var t=s.indexOf(e);0<=t&&s.splice(t,1),window.clearInterval(e)},A.UIShell.Xo=function(){for(var e=0;e<s.length;e++)window.clearInterval(s[e]);s=[]},A.App={userData:null,appData:{}},A.App.GLOBAL_HEADER_CONFIG_KEY="jraf.headerconfig",A.App.APP_NAME_CONFIG_KEY="jraf.appname",A.App.APP_CONTEXT_CONFIG_KEY="jraf.appcontext",A.App.ROOT_ROUTER_CONFIG_KEY="jraf.rootrouter",A.App.ROOT_ROUTER_STATE_CONFIG_KEY="jraf.rootrouter.state",A.App.getUserData=function(){return A.App.userData},A.App.setUserData=function(e){A.App.userData=e},A.App.getAppData=function(){return A.App.appData},A.App.setAppData=function(e){A.App.appData=e},A.App.setAppDataProperty=function(e,t){A.App.appData||(A.App.appData={}),A.App.appData[e]=t},A.App.getAppDataProperty=function(e){return A.App.appData?A.App.appData[e]:null},A.App.clearAppDataProperty=function(e){A.App.appData&&(A.App.appData[e]=void 0)},A.App.setLanguage=function(e){var a=r.isRightToLeft(e)?"rtl":"ltr";return new Promise((function(n){t.Config.setLocale(e,(function(){p("html").attr({lang:e,dir:a}),p("link.jraf-update-url-direction").each((function(){r.updateLinkDirection(p(this),a)})),n()}))}))},A.App.clearAppData=function(){A.UIShell.Xo(),A.App.userData=null,A.App.appData.unsavedChanges=void 0,A.App.clearAuthenticatedUser()},A.App.setAuthenticatedUser=function(e){window.sessionStorage.setItem("jraf.user",e)},A.App.getAuthenticatedUser=function(){return window.sessionStorage.getItem("jraf.user")},A.App.isAuthenticated=function(){var e=window.sessionStorage.getItem("jraf.user");return a.isNonemptyString(e)},A.App.clearAuthenticatedUser=function(){window.sessionStorage.removeItem("jraf.user")},A.App.initializeUserData=function(){var e=n.getIdentityService();if(!a.isObjectStrict(e)||!a.isFunction(e.getUserData))throw new Error("jraf.App.initializeUserData: Identity Service implementation is required by the UI Shell.");return new Promise((function(p,r){e.getUserData().then((function(e){A.App.setAuthenticatedUser(e.userid),A.App.setUserData(e),A.App.setLanguage(e.prefLang).then((function(){p(e)}))})).catch((function(e){t.Logger.warn("jraf.App.initializeUserData: failure occurred (%s).",e),r(e)}))}))},A.App.login=function(e,t){return A.App.Yo(e,t)},A.App.Yo=function(e,p){var r=n.getIdentityService();if(!a.isObjectStrict(r)||!a.isFunction(r.executeLogin))throw new Error("jraf.App._defaultLogin: Identity Service implementation is required by the UI Shell.");return new Promise((function(a,n){r.executeLogin(e,p).then((function(){A.App.initializeUserData().then((function(e){a(e)}))})).catch((function(e){t.Logger.warn("jraf.App._defaultLogin: Failure occurred during login (%s).",e),n(e)}))}))},A.App.getGlobalHeaderConfig=function(){var t=A.App.getAppDataProperty(A.App.GLOBAL_HEADER_CONFIG_KEY);return t||(t={processingIndicatorColor:e.observable(null),applicationIcon:e.observable(null),applicationName:e.observable(null),maxLogoSize:e.observable(null),initialized:e.observable(!1)},A.App.setAppDataProperty(A.App.GLOBAL_HEADER_CONFIG_KEY,t)),t},A.App.setApplicationName=function(e){A.App.setAppDataProperty(A.App.APP_NAME_CONFIG_KEY,e)},A.App.getApplicationName=function(){return A.App.Zo||(A.App.Zo=e.pureComputed((function(){var e=A.App.getGlobalHeaderConfig().applicationName(),p=A.App.getAppDataProperty(A.App.APP_NAME_CONFIG_KEY),r=t.Translations.getTranslatedString("jraf.sidebar.defaultAppNavName");return a.isNonemptyString(e)?e:a.isNonemptyString(p)?p:r}),this,{deferEvaluation:!0})),A.App.Zo},A.App.registerRootRouter=function(e){if(!(a.isObjectStrict(e)&&e instanceof i))throw new Error("jraf.App.registerRootRouter: Must pass instance of CoreRouter.");if(A.App.getAppDataProperty(A.App.ROOT_ROUTER_CONFIG_KEY))throw new Error("jraf.App.registerRootRouter: Root router has already been registered.");A.App.setAppDataProperty(A.App.ROOT_ROUTER_CONFIG_KEY,e),e.currentState.subscribe((function(e){var t=e.state;A.App.setAppDataProperty(A.App.ROOT_ROUTER_STATE_CONFIG_KEY,t)}))},A.App.getRootRouter=function(){return A.App.getAppDataProperty(A.App.ROOT_ROUTER_CONFIG_KEY)},A.App.getRootRouterState=function(){return A.App.getAppDataProperty(A.App.ROOT_ROUTER_STATE_CONFIG_KEY)},A}));