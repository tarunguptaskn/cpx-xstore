define(["jquery","knockout","ojs/ojcore","jraf/jrafcore","jraf/models/UIShellManager","jraf/models/HeaderMenus","jraf/utils/ValidationUtils","ojs/ojknockouttemplateutils","ojs/ojknockout","ojs/ojnavigationlist","ojs/ojjsontreedatasource"],(function(e,t,n,i,r,s,a,o){"use strict";var u=n.Translations.getTranslatedString;function h(e){if(!(a.isObjectStrict(e)&&e.menus instanceof s))throw new TypeError("AdditionalOptionsMenu: Missing required parameters");var t=this;this.userMenuId=i.UIShell.generateUniqueId(),this.helpMenuId=i.UIShell.generateUniqueId(),this.menuItemTemplateId=i.UIShell.generateUniqueId(),this.navListId=i.UIShell.generateUniqueId(),this.preferencesLabel=u("jraf.global.preferences"),this.userMenuLogOutLabel=u("jraf.global.userMenuLogOutLabel"),this.helpLabel=u("jraf.global.help"),this.aboutLabel=u("jraf.global.about"),this.rootLabel=u("jraf.global.optionsMenu"),this.qj=e.menus,this.ja(),this.getMenuItemTemplate=function(){return o.getRenderer(t.menuItemTemplateId,!0)}}return h.prototype.ja=function(){var e=this.qj.getUserData();this.username=e.username,this.Ja(e.avatar),this.userMenuItems=this.qj.getUserMenu(),this.helpMenuItems=this.qj.getHelpMenu();var i=[{attr:{id:this.userMenuId,label:this.username,avatar:this.avatar,type:"usermenu"},children:this.Oj(this.userMenuItems)},{attr:{id:this.helpMenuId,label:this.helpLabel,type:"helpmenu"},children:this.Oj(this.helpMenuItems)}];this.dataSource=new n.JsonTreeDataSource(i),this.Aj(),this.Tj(),this.Vj=t.observableArray([]),this.drillLabel=t.pureComputed((function(){var e=this.zj();return null===e?null:t.unwrap(this.Dj[e])}),this)},h.prototype.Oj=function(t){for(var n=[],i=0;i<t.length;i++){var r={},s=t[i];if(s.rendered){if(s.children){var a=this.Oj(s.children);r.children=a}r.attr={},e.extend(r.attr,s),r.attr.children&&delete r.attr.children,n.push(r)}}return n},h.prototype.Tj=function(){var e=this;this.beforeSelect=function(t){e.Gj(t)},this.beforeExpand=function(t){e.kj(t)},this.beforeCollapse=function(){e.yj()},this.navigateBack=function(){e.Jj()}},h.prototype.Ja=function(e){this.avatar=t.pureComputed((function(){var t=e();return t?{backgroundImage:"url('"+t+"')"}:null}))},h.prototype.Aj=function(){var e=this;this.Dj={},this.Dj[this.userMenuId]=this.username,this.Dj[this.helpMenuId]=this.helpLabel,this.userMenuItems.forEach((function(t){e.Kj(t)})),this.helpMenuItems.forEach((function(t){e.Kj(t)}))},h.prototype.Kj=function(e){var t=this;this.Dj[e.id]=e.label,a.isArray(e.children)&&e.children.forEach((function(e){t.Kj(e)}))},h.prototype.Gj=function(e){var t=e.detail.key;this.qj.isMenuLeaf(t)&&(this.qj.handleMenuItemSelection(t),e.preventDefault(),r.closeMobileOptionsMenu())},h.prototype.kj=function(e){this.Vj.push(e.detail.key)},h.prototype.yj=function(){this.Vj.pop()},h.prototype.Jj=function(){var t=this.zj();e("#"+this.navListId).ojNavigationList("collapse",t)},h.prototype.zj=function(){var e=this.Vj();return 0===e.length?null:e[e.length-1]},h}));