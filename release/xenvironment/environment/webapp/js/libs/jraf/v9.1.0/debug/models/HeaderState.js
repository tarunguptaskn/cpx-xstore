define(["knockout","ojs/ojcore","jraf/jrafcore","jraf/services/ServiceManager","jraf/models/UIShellManager","jraf/models/ProcessingIndicatorManager"],(function(i,o,n,t,a,e){"use strict";function s(){this._initializeProcessingIndicator(),this._initializeHeaderCustomization()}return s.COLOR_REGEX=/^#[\da-f]{3}([\da-f]{3})?$/i,s.prototype._initializeProcessingIndicator=function(){this.processingIndicatorManager=new e,a.RegisterProcessingIndicatorManager(this.processingIndicatorManager)},s.prototype._initializeHeaderCustomization=function(){var o=this;this.configLoaded=i.observable(!1);var e=n.App.getGlobalHeaderConfig();if(this._syncConfig(e),n.App.isAuthenticated())if(this.configInitialized())this._handleExistingConfig();else{a.startProcessingIndicator();var s=t.getGlobalAreaConfigurationService();if(s)return s.getGlobalAreaConfigurations().then((function(i){o._handleLoadConfigSuccess(i)}),(function(i){o._handleLoadConfigFailure(i)}));a.stopProcessingIndicator(),this.configInitialized(!0),this.configLoaded(!0)}else this.configLoaded(!0)},s.prototype._handleExistingConfig=function(){this.configLoaded(!0)},s.prototype._syncConfig=function(i){this.processingIndicatorColor=i.processingIndicatorColor,this.applicationIcon=i.applicationIcon,this.applicationName=i.applicationName,this._maxLogoSize=i.maxLogoSize,this.configInitialized=i.initialized},s.prototype._handleLoadConfigSuccess=function(i){if(s.COLOR_REGEX.test(i.processingIndicatorColor)&&this.processingIndicatorColor(i.processingIndicatorColor),i.logo){var o=i.logo,n=this._getLogoContentString(o);this.applicationIcon(n)}i.applicationName&&this.applicationName(i.applicationName),i.maxLogoSize&&this._maxLogoSize(i.maxLogoSize),a.stopProcessingIndicator(),this.configInitialized(!0),this.configLoaded(!0)},s.prototype._getLogoContentString=function(i){var o=i.substring(0,20);return 0===window.atob(o).indexOf("<?xml")?"data:image/svg+xml;base64,"+i:"data:image/png;base64,"+i},s.prototype._handleLoadConfigFailure=function(i){o.Logger.warn("HeaderState._handleLoadConfigFailure: failed loading data with reason "+i),a.stopProcessingIndicator(),this.configInitialized(!0),this.configLoaded(!0)},s}));