define(["ojs/ojcore","knockout","jquery","jraf/utils/ValidationUtils"],(function(e,n,t,o){"use strict";function u(e){if(!(o.isObjectStrict(e)&&o.isNonemptyString(e.popupId)&&n.isObservable(e.selectedMenuItemId)&&n.isObservable(e.activeMenuModuleBinding)))throw new TypeError("PopupMenuManager: Invalid menu configuration.");this.menuPopupId=e.popupId,this.selectedMenuItemId=e.selectedMenuItemId,this.activeMenuModuleBinding=e.activeMenuModuleBinding,this.renderedMenuLauncherId=null,this._menuOpen=n.observable(!1),this._bindEventHandlers()}return u.prototype._bindEventHandlers=function(){var n=this,t=this._getMenuPopup();t.onOjBeforeClose=function(){e.Logger.info("PopupMenuManager: Entering ojBeforeClose event handler."),n._clearMenuSelection(),n._menuOpen(!1)},t.onOjOpen=function(){n._menuOpen(!0)}},u.prototype._getMenuPopup=function(){return document.getElementById(this.menuPopupId)},u.prototype._clearMenuSelection=function(){this.selectedMenuItemId()&&this.selectedMenuItemId(null)},u.prototype._getLauncher=function(e){return t("#"+e).get(0)},u.prototype._openMenuPopup=function(e){var n=this._getLauncher(e);this._getMenuPopup().open(n,{at:{horizontal:"start",vertical:"bottom"},my:{horizontal:"start",vertical:"top"},collision:"fit"})},u.prototype._closeMenuPopup=function(){this._getMenuPopup().close()},u.prototype.openMenu=function(n){if(!o.isObjectStrict(n)||!o.isNonemptyString(n.launcherId)||!o.isObjectStrict(n.moduleBinding))throw new TypeError("PopupMenuManager.openMenu: Invalid input.");var t=n.launcherId;e.Logger.info("PopupMenuManager.openMenu: Opening popup menu for launcher %s.",t),this.renderedMenuLauncherId!==t&&(e.Logger.info("PopupMenuManager.openMenu: new launcherId passed, so updating activeMenuModuleBinding."),this.renderedMenuLauncherId=t,this.activeMenuModuleBinding(n.moduleBinding)),this._openMenuPopup(n.launcherId)},u.prototype.closeMenu=function(){e.Logger.info("PopupMenuManager.closeMenu: Closing popup menu: %s",this.selectedMenuItemId()),this._closeMenuPopup(),this._clearMenuSelection()},u.prototype.getMenuState=function(){return n.pureComputed((function(){return this._menuOpen()}),this)},u.prototype.resetMenu=function(){this._clearMenuSelection(),this.activeMenuModuleBinding(null)},u}));