define(["jquery","jraf/utils/UrlUtils","jraf/utils/ValidationUtils"],(function(e,t,r){"use strict";function i(e,t,n){if(!r.isNonemptyString(t))throw new TypeError("CustomizedResourceService requires a base uri.");if(r.isObjectStrict(e)?(this.appCode=e.appCode,this.Sc=e.clientAppCode):this.appCode=e,!r.isNonemptyString(this.appCode))throw new TypeError("CustomizedResourceService requires an application code.");this.baseUri=t,this.pageSize=n||i.PAGE_SIZE}return i.PAGE_SIZE=1e3,i.SERVICE_URL_PATH="services/private/bundles/texts",i.SERVICE_VERSION="1.2.0",i.prototype.Cc=function(e){var r=this.baseUri;return"/"!==r.slice(-1)&&(r+="/"),r+=i.SERVICE_URL_PATH+e,this.Sc&&(r=t.injectQueryParameter(r,"clientAppCode",this.Sc)),r},i.prototype.mc=function(){return{"Accept-Version":i.SERVICE_VERSION,Accept:"application/json","Content-Type":"application/json"}},i.prototype.Tc=function(e){var t=this;return new Promise((function(r,i){e.done((function(){r.apply(this,arguments)})),e.fail((function(e,r,n){i(t.zc(e,n))}))}))},i.prototype.zc=function(e,t){if(!r.isObjectStrict(e)||!r.isNonemptyString(e.responseText))return t;var i,n=e.responseText;try{i=JSON.parse(n)}catch(e){window.console.log("Warning: _getFailureReason: responseText was not JSON.")}return r.isArray(i)&&r.isObjectStrict(i[0])&&r.isNonemptyString(i[0].message)?i[0].message:n},i.prototype.getCustomizedResources=function(e,t){this.currentResourceBundle=[];var r=e.replace(/^.*[\\\/]/,"");return this.Rc(r,t,1)},i.prototype.Rc=function(t,i,n){var o=this,s=this.Cc("?bundleName="+t+"&customized=true&pageSize="+this.pageSize+"&pageNumber="+n+"&languageTag="+("root"===i?"en":i)+"&appCode="+this.appCode),c=e.ajax(s,{headers:this.mc(),dataType:"json",xhrFields:{withCredentials:!0}});return this.Tc(c).then((function(e){if(r.isObjectStrict(e)){var n=o.xc(e);return o.currentResourceBundle=o.currentResourceBundle.concat(n),0<e.totalPageCount&&e.totalPageCount!==e.currentPageNumber?o.Rc(t,i,e.currentPageNumber+1):o.currentResourceBundle}return window.console.log("CustomizedResourceService._getCustomizedResources: Returned data not in expected format"),[]}))},i.prototype.xc=function(e){for(var t=[],r=e.resourceTexts,i=0;i<r.length;i++)t.push({resourceKey:r[i].resourceKey,sourceText:r[i].customText});return t},i}));