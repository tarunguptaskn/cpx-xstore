define(["knockout","ojs/ojlogger","ojs/ojanimation"],(function(t,e,s){"use strict";function i(t){this._context=t,this._toastCounter=0,this._initializeProperties(this._context.properties)}function o(t,e){this._toastId=t,this._toaster=e}return i.prototype._initializeProperties=function(t){var e=this._context.uniqueId;this.toasterWrapperId=e+"_wrapper",this.maximumToastsVisible=t.maximum,this._activeToastRefs=[],this._toastQueue=[]},i.prototype.openToast=function(t){var e=t.severity;if("info"===e||"warning"===e||"error"===e||"success"===e)return this._openToast(t);throw new TypeError("oj-rgbu-jraf-toaster.openToast: severity is invalid.")},i.prototype._openToast=function(t){var e=this._getToastViewModel(t);return this._toastQueue.push(e),this._showNextAvailableToast(),e.context},i.prototype._showNextAvailableToast=function(){if(this._activeToastRefs.length<this.maximumToastsVisible&&this._toastQueue.length>0){var t=this._toastQueue.shift();this._showToast(t)}},i.prototype._showToast=function(e){var s=document.getElementById(this.toasterWrapperId),i=e.id,o=e.wrapperId,a=this._getToastElement(i,o);this._activeToastRefs.push({id:i,element:a}),s.appendChild(a),t.applyBindings(e,document.getElementById(i))},i.prototype._getToastElement=function(t,e){var s=document.createElement("oj-rgbu-jraf-toast");s.setAttribute("id",t),s.setAttribute("toast-type","[[toastType]]"),s.setAttribute("severity","[[severity]]"),s.setAttribute("toast-title","[[toastTitle]]"),s.setAttribute("message","[[message]]"),s.setAttribute("primary-button","[[primaryButton]]"),s.setAttribute("secondary-button","[[secondaryButton]]"),s.setAttribute("auto-dismiss","[[autoDismiss]]"),s.setAttribute("auto-dismiss-timeout","[[autoDismissTimeout]]"),s.setAttribute("on-oj-rgbu-jraf-toast-dismissed","[[handleToastDismissed]]");var i=document.createElement("div");return i.setAttribute("id",e),i.appendChild(s),i},i.prototype._getToastViewModel=function(t){var e=this,s=this._toastCounter++,i=this._context.uniqueId+"toast"+s;return{id:i,wrapperId:this._context.uniqueId+"toast-wrapper"+s,toastType:t.toastType,severity:t.severity,toastTitle:t.toastTitle,message:t.message,primaryButton:t.primaryButton,secondaryButton:t.secondaryButton,autoDismiss:t.autoDismiss,autoDismissTimeout:t.autoDismissTimeout,handleToastDismissed:function(t,s){return e._handleToastDismissed(t,s)},context:new o(i,this)}},i.prototype._handleToastDismissed=function(t){var e=this,s=t.target.id;this._removeToast(s).then((function(){e._showNextAvailableToast()}))},i.prototype._getActiveToastRefById=function(t){var e=this._activeToastRefs.filter((function(e){return e.id===t}));return 1===e.length?e[0]:null},i.prototype._removeToast=function(i){var o=this;e.info("Toaster._removeToast: Removing %s.",i);var a=document.getElementById(i).parentElement;return s.collapse(a,{duration:"150ms",persist:"all"}).then((function(){t.removeNode(a),o._cleanupToastState(i)}))},i.prototype._cleanupToastState=function(t){for(var s=-1,i=0;i<this._activeToastRefs.length;i++){if(this._activeToastRefs[i].id===t){s=i;break}}-1!==s?this._activeToastRefs.splice(s,1):e.warn("Toaster._cleanupToastState: Did not find state for toast %s.",t)},i.prototype._cancelToast=function(t){for(var s=-1,i=0;i<this._toastQueue.length;i++)if(this._toastQueue[i].id===t){s=i;break}-1!==s?this._toastQueue.splice(s,1):e.warn("Toaster._cancelToast: Did not find state for toast %s.",t)},o.prototype.isQueued=function(){for(var t=this._toaster._toastQueue,e=0;e<t.length;e++)if(t[e].id===this._toastId)return!0;return!1},o.prototype.isShown=function(){for(var t=this._toaster._activeToastRefs,e=0;e<t.length;e++)if(t[e].id===this._toastId)return!0;return!1},o.prototype.isDismissed=function(){return!this.isQueued()&&!this.isShown()},o.prototype.dismiss=function(){if(this.isQueued())this._toaster._cancelToast(this._toastId);else if(this.isShown()){var t=document.getElementById(this._toastId);t&&t.dismiss()}},i}));