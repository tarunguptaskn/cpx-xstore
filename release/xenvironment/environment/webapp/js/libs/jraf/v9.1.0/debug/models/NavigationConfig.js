define(["jraf/utils/ValidationUtils","jraf/models/NavigationHelper","jraf/models/NavigationMenuItem","jraf/models/Content","jraf/services/ServiceManager","jraf/jrafcore"],(function(e,t,i,a,n,o){"use strict";function s(t){if(!e.isObjectStrict(t))throw new TypeError("NavigationConfig: Missing required navigation config.");var i=e.isBoolean(t.renderNavigation);this.renderNavigation=i?t.renderNavigation:!e.isBoolean(t.renderSidebarArea)||t.renderSidebarArea,this.renderNavigation&&this._initializeConfigProperties(t)}return s.APP_NAVIGATOR_ID="app-navigator",s.FAVORITES_ID="favorites",s.TASKS_ID="tasks",s.NOTIFICATIONS_ID="notifications",s.QUICK_CREATE_ID="quick-create",s.QUICK_LOOKUP_ID="quick-lookup",s.REPORTS_ID="reports",s.SETTINGS_ID="settings",s.TASKS_FAVORITE_TYPE="task",s.REPORTS_FAVORITE_TYPE="report",s.SETTINGS_FAVORITE_TYPE="task",s.MAX_MENU_ITEMS=8,s.DEFAULT_POLLING_INTERVAL=3e4,s.SIDEBAR_LAYOUT="sidebar",s.HORIZONTAL_LAYOUT="horizontal",s.prototype._initializeConfigProperties=function(t){this.exposeLayoutConfiguration=e.getBoolean(t.exposeLayoutConfiguration,!1);var i=s.isValidLayout(t.defaultNavigationLayout);this.defaultNavigationLayout=i?t.defaultNavigationLayout:s.SIDEBAR_LAYOUT,this._pollingInterval=t.pollingInterval||s.DEFAULT_POLLING_INTERVAL,this.menuItems=[],this._notificationsEnabled=!e.getBoolean(t.hideNotifications,!1),this._renderNotificationReassignment=e.getBoolean(t.renderNotificationReassignment,!0),this._beforeOpenContentHandler=t.beforeOpenContentHandler,this._beforeLoadModuleHandler=t.beforeLoadModuleHandler,this._afterUnloadModuleHandler=t.afterUnloadModuleHandler,this._initializeAppNavigator(t),this._initializeFavorites(t),this._initializeTasks(t),this._initializeNotifications(t),this._initializeReports(t),this._initializeQuickCreate(t),this._initializeQuickLookup(t),this._initializeSettings(t),this._initializeCustomMenuItems(t),this._initializeDefaultContentCallbacks(t)},s.isValidLayout=function(e){return[s.SIDEBAR_LAYOUT,s.HORIZONTAL_LAYOUT].indexOf(e)>=0},s.prototype._addMenuItem=function(e){this.menuItems.push(e)},s.prototype._initializeAppNavigator=function(t){e.getBoolean(t.hideAppNavigator,!1)||this._addAppNavigatorMenuItem(t)},s.prototype._addAppNavigatorMenuItem=function(e){var t={name:"jraf/appnavigator/SidebarNavigator",params:{launchApplicationCallback:e.launchApplicationCallback}},a={name:"jraf/appnavigator/NavigatorMenuBody",params:{launchApplicationCallback:e.launchApplicationCallback,layout:"horizontal"}};this._addMenuItem(new i({id:s.APP_NAVIGATOR_ID,icon:"jraf-app-navigator-icon",selectedIcon:"jraf-app-navigator-selected-icon",iconLabel:"jraf.sidebar.appNavigator",badgingEnabled:!1,sidebarMenuModuleBinding:t,horizontalMenuModuleBinding:a}))},s.prototype._initializeFavorites=function(t){this.hideFavorites=e.getBoolean(t.hideFavorites,!1),this.hidePinnedFavorites=e.getBoolean(t.hidePinnedFavorites,!1),this.hideFavorites||(this._displayFavoriteTitleInTab=e.getBoolean(t.displayFavoriteTitleInTab,!1),this._addFavoritesMenuItem(t))},s.prototype._addFavoritesMenuItem=function(e){var t={name:"jraf/UIShellFavoritesMenu",params:{hidePinnedFavorites:this.hidePinnedFavorites}},a={name:"jraf/favorites/HorizontalFavoritesMenu",params:{hidePinnedFavorites:this.hidePinnedFavorites}};this._addMenuItem(new i({id:s.FAVORITES_ID,icon:"jraf-favorites-icon",selectedIcon:"jraf-favorites-selected-icon",iconLabel:"jraf.sidebar.favorites.title",badgingEnabled:!1,sidebarMenuModuleBinding:t,horizontalMenuModuleBinding:a}))},s.prototype._initializeTasks=function(t){if(!e.getBoolean(t.hideTasks,!1)){if(!this._hasTasksCallback("getTasks",t.getTasksCallback))throw new TypeError("NavigationConfig: Invalid configuration. Must register TasksService or provide getTasksCallback if hideTasks is false (default).");this._addTasksMenuItem(t)}},s.prototype._hasTasksCallback=function(t,i){return this._hasTasksService(t)||e.isFunction(i)},s.prototype._hasTasksService=function(t){var i=n.getTasksService();return i&&e.isFunction(i[t])},s.prototype._getTasksServiceCallback=function(e,t){return this._hasTasksService(e)?function(){return n.getTasksService()[e]()}:t},s.prototype._getTasksMenuCallback=function(e){return this._getTasksServiceCallback("getTasks",e.getTasksCallback)},s.prototype._getReportsMenuCallback=function(e){return this._getTasksServiceCallback("getReports",e.getReportsCallback)},s.prototype._getSettingsMenuCallback=function(e){return this._getTasksServiceCallback("getSettings",e.getSettingsCallback)},s.prototype._addTasksMenuItem=function(e){var t=this._getTasksMenuCallback(e),a="string"==typeof e.tasksMenuHeader&&e.tasksMenuHeader.length>0?e.tasksMenuHeader:"jraf.sidebar.tasks",n={name:"jraf/UIShellTasksMenu",params:{header:a,navListLabel:"jraf.sidebar.tasksListDescription",searchPlaceholderText:"jraf.sidebar.taskSearchPlaceholder",autosuggestAdditionalResultsText:"jraf.sidebar.additionalTasks",getTasks:t,taskId:o.UIShell.TASKS_DATA_LOAD_ID,favoritesEnabled:!this.hideFavorites,favoritesType:s.TASKS_FAVORITE_TYPE}},r={name:"jraf/tasks/HorizontalTasksMenu",params:{navListLabel:"jraf.sidebar.tasksListDescription",getTasks:t,taskId:o.UIShell.TASKS_DATA_LOAD_ID,favoritesEnabled:!this.hideFavorites,favoritesType:s.TASKS_FAVORITE_TYPE}};this._addMenuItem(new i({id:s.TASKS_ID,icon:"jraf-tasks-icon",selectedIcon:"jraf-tasks-selected-icon",iconLabel:a,badgingEnabled:!1,sidebarMenuModuleBinding:n,horizontalMenuModuleBinding:r}))},s.prototype._initializeNotifications=function(e){this.hasNotificationsEnabled()&&this._addNotificationsMenuItem(e)},s.prototype._addNotificationsMenuItem=function(e){var t=n.getNotificationsService();if(!t)throw new Error("NavigationConfig._addNotificationsMenuItem: A notifications service is required by the Notifications UI.");var a=new i({id:s.NOTIFICATIONS_ID,icon:"jraf-notifications-icon",selectedIcon:"jraf-notifications-selected-icon",iconLabel:"jraf.sidebar.notifications.title",badgingEnabled:!0,badgeValue:function(){return t.getUnreadNotificationCount()},sidebarMenuModuleBinding:{name:"jraf/UIShellNotificationsMenu",params:{}},horizontalMenuModuleBinding:{name:"jraf/notifications/HorizontalNotificationsMenu",params:{}}});this._addMenuItem(a);var o=a.getBadgeValue();a.getSidebarMenuModuleBinding().params.badgeValue=o,a.getHorizontalMenuModuleBinding().params.badgeValue=o},s.prototype._initializeQuickCreate=function(t){e.getBoolean(t.hideQuickCreate,!0)||this._addQuickCreateMenuItem(t)},s.prototype._addQuickCreateMenuItem=function(e){var t={viewName:"jraf/UIShellQuickCreateMenu"};this._addMenuItem(new i({id:s.QUICK_CREATE_ID,icon:"jraf-quick-create-icon",selectedIcon:"jraf-quick-create-selected-icon",iconLabel:"jraf.sidebar.quickCreate",badgingEnabled:!1,sidebarMenuModuleBinding:t,horizontalMenuModuleBinding:t}))},s.prototype._initializeQuickLookup=function(t){e.getBoolean(t.hideQuickLookup,!0)||this._addQuickLookupMenuItem(t)},s.prototype._addQuickLookupMenuItem=function(e){var t={viewName:"jraf/UIShellQuickLookupMenu"};this._addMenuItem(new i({id:s.QUICK_LOOKUP_ID,icon:"jraf-quick-lookup-icon",selectedIcon:"jraf-quick-lookup-selected-icon",iconLabel:"jraf.sidebar.quickLookup",badgingEnabled:!1,sidebarMenuModuleBinding:t,horizontalMenuModuleBinding:t}))},s.prototype._initializeReports=function(t){if(!e.getBoolean(t.hideReports,!0)){if(!this._hasTasksCallback("getReports",t.getReportsCallback))throw new TypeError("NavigationConfig: Invalid configuration. Must register TasksService or provide getReportsCallback if hideReports is false.");this._addReportsMenuItem(t)}},s.prototype._addReportsMenuItem=function(e){var t=this._getReportsMenuCallback(e),a={name:"jraf/UIShellTasksMenu",params:{header:"jraf.sidebar.reports",navListLabel:"jraf.sidebar.reportsListDescription",searchPlaceholderText:"jraf.sidebar.reportSearchPlaceholder",autosuggestAdditionalResultsText:"jraf.sidebar.additionalReports",getTasks:t,taskId:o.UIShell.REPORTS_DATA_LOAD_ID,favoritesEnabled:!this.hideFavorites,favoritesType:s.REPORTS_FAVORITE_TYPE}},n={name:"jraf/tasks/HorizontalTasksMenu",params:{navListLabel:"jraf.sidebar.reportsListDescription",getTasks:t,taskId:o.UIShell.REPORTS_DATA_LOAD_ID,favoritesEnabled:!this.hideFavorites,favoritesType:s.REPORTS_FAVORITE_TYPE}};this._addMenuItem(new i({id:s.REPORTS_ID,icon:"jraf-reports-icon",selectedIcon:"jraf-reports-selected-icon",iconLabel:"jraf.sidebar.reports",badgingEnabled:!1,sidebarMenuModuleBinding:a,horizontalMenuModuleBinding:n}))},s.prototype._initializeSettings=function(t){if(!e.getBoolean(t.hideSettings,!0)){if(!this._hasTasksCallback("getSettings",t.getSettingsCallback))throw new TypeError("NavigationConfig: Invalid configuration. Must register TasksService or provide getSettingsCallback if hideSettings is false.");this._addSettingsMenuItem(t)}},s.prototype._addSettingsMenuItem=function(e){var t=this._getSettingsMenuCallback(e),a={name:"jraf/UIShellTasksMenu",params:{header:"jraf.sidebar.settings",navListLabel:"jraf.sidebar.settingsListDescription",searchPlaceholderText:"jraf.sidebar.settingsSearchPlaceholder",autosuggestAdditionalResultsText:"jraf.sidebar.additionalSettings",getTasks:t,taskId:o.UIShell.SETTINGS_DATA_LOAD_ID,favoritesEnabled:!this.hideFavorites,favoritesType:s.SETTINGS_FAVORITE_TYPE}},n={name:"jraf/tasks/HorizontalTasksMenu",params:{navListLabel:"jraf.sidebar.settingsListDescription",getTasks:t,taskId:o.UIShell.SETTINGS_DATA_LOAD_ID,favoritesEnabled:!this.hideFavorites,favoritesType:s.SETTINGS_FAVORITE_TYPE}};this._addMenuItem(new i({id:s.SETTINGS_ID,icon:"jraf-settings-icon",selectedIcon:"jraf-settings-selected-icon",iconLabel:"jraf.sidebar.settings",badgingEnabled:!1,sidebarMenuModuleBinding:a,horizontalMenuModuleBinding:n}))},s.prototype._initializeCustomMenuItems=function(t){var a=e.isArray(t.customMenuItems)?t.customMenuItems:t.customSidebarMenuItems;e.isArray(a)&&a.forEach((function(e,t){if(!(e instanceof i))throw new TypeError("NavigationConfig: customMenuItems index #"+t+" must be a NavigationMenuItem instance.");this._addMenuItem(e)}),this)},s.prototype._initializeDefaultContentCallbacks=function(e){this.defaultContentCallbacks={},this._hasTasksCallback("getTasks",e.getTasksCallback)&&(this.defaultContentCallbacks[o.UIShell.TASKS_DATA_LOAD_ID]=this._getTasksMenuCallback(e)),this._hasTasksCallback("getReports",e.getReportsCallback)&&(this.defaultContentCallbacks[o.UIShell.REPORTS_DATA_LOAD_ID]=this._getReportsMenuCallback(e)),this._hasTasksCallback("getSettings",e.getSettingsCallback)&&(this.defaultContentCallbacks[o.UIShell.SETTINGS_DATA_LOAD_ID]=this._getSettingsMenuCallback(e)),this._hasCustomLaunchableContent(e)&&(this.defaultContentCallbacks[o.UIShell.LAUNCHABLE_DATA_LOAD_ID]=this._getLaunchableContentCallback(e))},s.prototype._hasCustomLaunchableContent=function(t){return e.isFunction(t.getLaunchableContent)||this.hasNotificationsEnabled()},s.prototype._getLaunchableContentCallback=function(t){var i=this;return function(){return(e.isFunction(t.getLaunchableContent)?t.getLaunchableContent():Promise.resolve([])).then((function(e){return i._getLaunchableContentFolder(i._getAllLaunchableContent(e))}))}},s.prototype._getAllLaunchableContent=function(t){if(!e.isArray(t))throw new TypeError("NavigationConfig._getAllLaunchableContent: launchableContent must be an array");return t.concat(this._getLaunchableJrafContent()).filter((function(e){return e.resourceType===a.CONTENT_TYPE_MODULE||e.resourceType===a.CONTENT_TYPE_URL}))},s.prototype._getLaunchableContentFolder=function(e){return{id:"jraf.navigation.launchable.merged",title:"Merged Launchable Content",resourceType:a.CONTENT_TYPE_FOLDER,children:e}},s.prototype._getLaunchableJrafContent=function(){var e=[];return this.hasNotificationsEnabled()&&e.push(t.getNotificationsPageContentConfig({})),e},s.prototype._getDefaultNavigationMenuItem=function(){for(var e,t,i,a=this._getVisibleMenuItems(),n=0;n<a.length;n++){var o=a[n];0===n&&(e=o),o.id===s.FAVORITES_ID?t=o:o.id===s.TASKS_ID&&(i=o)}return t||(i||(e||null))},s.prototype._getVisibleMenuItems=function(){var e=this.menuItems.length>s.MAX_MENU_ITEMS?s.MAX_MENU_ITEMS:this.menuItems.length;return this.menuItems.slice(0,e)},s.prototype.hasNavigation=function(){return this.renderNavigation},s.prototype.hasFavoritesEnabled=function(){return!this.hideFavorites},s.prototype.isDisplayFavoriteTitleInTab=function(){return this._displayFavoriteTitleInTab},s.prototype.hasPinnedFavoritesEnabled=function(){return!this.hidePinnedFavorites},s.prototype.hasNotificationsEnabled=function(){return this._notificationsEnabled},s.prototype.isLayoutConfigurable=function(){return this.renderNavigation&&this.exposeLayoutConfiguration},s.prototype.getDefaultNavigationLayout=function(){return this.defaultNavigationLayout},s.prototype.getDefaultMenuItem=function(){return this._getDefaultNavigationMenuItem()},s.prototype.getMenuItems=function(){return this._getVisibleMenuItems()},s.prototype.getDefaultContentCallbacks=function(){return this.defaultContentCallbacks},s.prototype.getPollingInterval=function(){return this._pollingInterval},s.prototype.getRenderNotificationReassignment=function(){return this._renderNotificationReassignment},s.prototype.getBeforeOpenContentHandler=function(){return this._beforeOpenContentHandler},s.prototype.getBeforeLoadModuleHandler=function(){return this._beforeLoadModuleHandler},s.prototype.getAfterUnloadModuleHandler=function(){return this._afterUnloadModuleHandler},s.buildCustomTasksNavigationMenuItem=function(t){if(!(e.isObjectStrict(t)&&e.isNonemptyString(t.id)&&e.isNonemptyString(t.iconLabel)&&e.isNonemptyString(t.icon)&&e.isNonemptyString(t.selectedIcon)&&e.isFunction(t.getTasks)&&e.isNonemptyString(t.headerLabel)&&e.isNonemptyString(t.navigationAriaLabel)&&e.isNonemptyString(t.searchPlaceholderLabel)&&e.isNonemptyString(t.autosuggestAdditionalResultsText)))throw new TypeError("NavigationConfig.buildCustomTasksNavigationMenuItem:  Missing required properties.");var a={name:"jraf/UIShellTasksMenu",params:{header:t.headerLabel,navListLabel:t.navigationAriaLabel,searchPlaceholderText:t.searchPlaceholderLabel,autosuggestAdditionalResultsText:t.autosuggestAdditionalResultsText,getTasks:t.getTasks,favoritesEnabled:t.favoritesEnabled,favoritesType:t.favoritesType}},n={name:"jraf/tasks/HorizontalTasksMenu",params:{navListLabel:t.navigationAriaLabel,getTasks:t.getTasks,favoritesEnabled:t.favoritesEnabled,favoritesType:t.favoritesType}};return new i({id:t.id,icon:t.icon,selectedIcon:t.selectedIcon,iconLabel:t.iconLabel,badgingEnabled:t.badgingEnabled,badgeValue:t.badgeValue,sidebarMenuModuleBinding:a,horizontalMenuModuleBinding:n})},s}));