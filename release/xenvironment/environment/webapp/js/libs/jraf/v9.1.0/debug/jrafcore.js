define(["knockout","ojs/ojcore","jquery","jraf/utils/I18nUtils","jraf/utils/ValidationUtils","jraf/services/ServiceManager","ojs/ojcorerouter"],(function(t,e,p,r,a,n,i){"use strict";var o={};"undefined"!=typeof window&&(o=window);var A=o.jraf={version:"9.1.0",build:"",revision:""};A.UIShell={},A.UIShell.TASKS_DATA_LOAD_ID="jraf.tasks",A.UIShell.REPORTS_DATA_LOAD_ID="jraf.reports",A.UIShell.SETTINGS_DATA_LOAD_ID="jraf.settings",A.UIShell.LAUNCHABLE_DATA_LOAD_ID="jraf.launchable";var u=0;A.UIShell.generateUniqueId=function(){return"jraf-ui-id-"+ ++u};var s=[];return A.UIShell.registerPollingId=function(t){s.indexOf(t)>=0||s.push(t)},A.UIShell.clearPollingId=function(t){var e=s.indexOf(t);e>=0&&s.splice(e,1),window.clearInterval(t)},A.UIShell._stopAllPolling=function(){for(var t=0;t<s.length;t++)window.clearInterval(s[t]);s=[]},A.App={userData:null,appData:{}},A.App.GLOBAL_HEADER_CONFIG_KEY="jraf.headerconfig",A.App.APP_NAME_CONFIG_KEY="jraf.appname",A.App.APP_CONTEXT_CONFIG_KEY="jraf.appcontext",A.App.ROOT_ROUTER_CONFIG_KEY="jraf.rootrouter",A.App.ROOT_ROUTER_STATE_CONFIG_KEY="jraf.rootrouter.state",A.App.getUserData=function(){return A.App.userData},A.App.setUserData=function(t){A.App.userData=t},A.App.getAppData=function(){return A.App.appData},A.App.setAppData=function(t){A.App.appData=t},A.App.setAppDataProperty=function(t,e){A.App.appData||(A.App.appData={}),A.App.appData[t]=e},A.App.getAppDataProperty=function(t){return A.App.appData?A.App.appData[t]:null},A.App.clearAppDataProperty=function(t){A.App.appData&&(A.App.appData[t]=void 0)},A.App.setLanguage=function(t){var a=r.isRightToLeft(t)?"rtl":"ltr";return new Promise((function(n){e.Config.setLocale(t,(function(){p("html").attr({lang:t,dir:a}),p("link.jraf-update-url-direction").each((function(){r.updateLinkDirection(p(this),a)})),n()}))}))},A.App.clearAppData=function(){A.UIShell._stopAllPolling(),A.App.userData=null,A.App.appData.unsavedChanges=void 0,A.App.clearAuthenticatedUser()},A.App.setAuthenticatedUser=function(t){window.sessionStorage.setItem("jraf.user",t)},A.App.getAuthenticatedUser=function(){return window.sessionStorage.getItem("jraf.user")},A.App.isAuthenticated=function(){var t=window.sessionStorage.getItem("jraf.user");return a.isNonemptyString(t)},A.App.clearAuthenticatedUser=function(){window.sessionStorage.removeItem("jraf.user")},A.App.initializeUserData=function(){var t=n.getIdentityService();if(!a.isObjectStrict(t)||!a.isFunction(t.getUserData))throw new Error("jraf.App.initializeUserData: Identity Service implementation is required by the UI Shell.");return new Promise((function(p,r){t.getUserData().then((function(t){A.App.setAuthenticatedUser(t.userid),A.App.setUserData(t),A.App.setLanguage(t.prefLang).then((function(){p(t)}))})).catch((function(t){e.Logger.warn("jraf.App.initializeUserData: failure occurred (%s).",t),r(t)}))}))},A.App.login=function(t,e){return A.App._defaultLogin(t,e)},A.App._defaultLogin=function(t,p){var r=n.getIdentityService();if(!a.isObjectStrict(r)||!a.isFunction(r.executeLogin))throw new Error("jraf.App._defaultLogin: Identity Service implementation is required by the UI Shell.");return new Promise((function(a,n){r.executeLogin(t,p).then((function(){A.App.initializeUserData().then((function(t){a(t)}))})).catch((function(t){e.Logger.warn("jraf.App._defaultLogin: Failure occurred during login (%s).",t),n(t)}))}))},A.App.getGlobalHeaderConfig=function(){var e=A.App.getAppDataProperty(A.App.GLOBAL_HEADER_CONFIG_KEY);return e||(e={processingIndicatorColor:t.observable(null),applicationIcon:t.observable(null),applicationName:t.observable(null),maxLogoSize:t.observable(null),initialized:t.observable(!1)},A.App.setAppDataProperty(A.App.GLOBAL_HEADER_CONFIG_KEY,e)),e},A.App.setApplicationName=function(t){A.App.setAppDataProperty(A.App.APP_NAME_CONFIG_KEY,t)},A.App.getApplicationName=function(){if(!A.App._getApplicationName){A.App._getApplicationName=t.pureComputed((function(){var t=A.App.getGlobalHeaderConfig().applicationName(),p=A.App.getAppDataProperty(A.App.APP_NAME_CONFIG_KEY),r=e.Translations.getTranslatedString("jraf.sidebar.defaultAppNavName");return a.isNonemptyString(t)?t:a.isNonemptyString(p)?p:r}),this,{deferEvaluation:!0})}return A.App._getApplicationName},A.App.registerRootRouter=function(t){if(!(a.isObjectStrict(t)&&t instanceof i))throw new Error("jraf.App.registerRootRouter: Must pass instance of CoreRouter.");if(A.App.getAppDataProperty(A.App.ROOT_ROUTER_CONFIG_KEY))throw new Error("jraf.App.registerRootRouter: Root router has already been registered.");A.App.setAppDataProperty(A.App.ROOT_ROUTER_CONFIG_KEY,t),t.currentState.subscribe((function(t){var e=t.state;A.App.setAppDataProperty(A.App.ROOT_ROUTER_STATE_CONFIG_KEY,e)}))},A.App.getRootRouter=function(){return A.App.getAppDataProperty(A.App.ROOT_ROUTER_CONFIG_KEY)},A.App.getRootRouterState=function(){return A.App.getAppDataProperty(A.App.ROOT_ROUTER_STATE_CONFIG_KEY)},A}));