define(["jquery","ojs/ojcore","knockout","jraf/jrafcore","jraf/models/favorites/FavoritesContent","jraf/models/favorites/FavoritesConfig","jraf/models/UIShellManager","jraf/utils/ValidationUtils","jraf/models/Content","ojs/ojmodule-element-utils","ojs/ojknockouttemplateutils","ojs/ojknockout","ojs/ojbutton","ojs/ojselectcombobox","ojs/ojnavigationlist","ojs/ojmodule-element"],(function(e,t,i,a,r,o,s,n,l,d,h){"use strict";var u=t.Translations.getTranslatedString;function v(e){var t=this;this.favoriteHandlerKey=e?e.favoriteHandlerKey:void 0,this.hidePinnedFavorites=n.getBoolean(e.hidePinnedFavorites,!1),this.hideEditFavorites=n.getBoolean(e.hideEditFavorites,!1),this.favoritesNavListId=a.UIShell.generateUniqueId(),this.searchInputId=a.UIShell.generateUniqueId(),this.autosuggestOptionTemplateId=a.UIShell.generateUniqueId(),this.flatListToggleId=a.UIShell.generateUniqueId(),this.headerText=u("jraf.sidebar.favorites.title"),this.editFavoritesButtonLabel=u("jraf.sidebar.favorites.editFavoritesLabel"),this.defaultEditFavoritesPageTitle=u("jraf.sidebar.favorites.editFavoritesPageTitle"),this.editFavoritesPageTitle=e.editFavoritesPageTitle||this.defaultEditFavoritesPageTitle,this.toggleGroupViewLabel=u("jraf.sidebar.favorites.toggleLabelGroupView"),this.toggleFlatListViewLabel=u("jraf.sidebar.favorites.toggleLabelFlatListView"),this.loadingText=u("jraf.messages.loading"),this.searchHint=u("jraf.sidebar.favorites.searchHint"),this.noResultsText=u("jraf.messages.noResults"),this.minimumAutosuggestLength=v.MINIMUM_AUTOSUGGEST_LENGTH,this.searchString=i.observableArray([]),this.av=o.getInstance().getFavoriteHandler(this.favoriteHandlerKey),this.Al=r.getInstance(this.av.getFavoritesService(),this.favoriteHandlerKey),this.gd=this.Al.getFavorites();var s=i.observable(!1);this.menuDataLoaded=i.pureComputed((function(){return s()})),this.drilledPath=i.observableArray([]),this.isHierarchyRoot=i.pureComputed((function(){return t.drilledPath().length<1})),this.lastDrilledNode=i.pureComputed((function(){return t.isHierarchyRoot()?null:t.drilledPath()[t.drilledPath().length-1]})),this.drilledNodeLabel=i.pureComputed((function(){return t.isHierarchyRoot()?"":t.fv(t.lastDrilledNode().favorite.entryId)()})),this.ab();var l={name:"jraf/favorites/FavoritesMenuBody",params:{favoritesNavListId:this.favoritesNavListId,menuDataLoaded:s,favoriteHandlerKey:this.favoriteHandlerKey,hidePinnedFavorites:this.hidePinnedFavorites,drilledPath:this.drilledPath,openContentCallback:function(e){t.Rg(e)},flatListEnabled:t.flatListEnabled}};this.favoritesBodyModuleConfig=d.createConfig(l),this.editFavorites=function(){t.Pd()},this.navigateUpHierarchy=function(){t.yd()},this.rb(),this.getAutosuggestOptionTemplate=function(){return h.getRenderer(t.autosuggestOptionTemplateId)},this.searchInputPickerAttributes={class:"jraf-sidebar-search"}}return v.MINIMUM_AUTOSUGGEST_LENGTH=1,v.prototype.fv=function(e){return this.av.getLocalizedTitle(e)},v.prototype.Rg=function(e){this.av.openContent(e),this.fb()},v.prototype.fb=function(){s.closeMenu({closeOverlayMenuOnly:!0})},v.prototype.Pd=function(){s.openContent(this.kd()),this.fb(),this.isHierarchyRoot()||this.navigateUpHierarchy()},v.prototype.kd=function(){return l.createModuleGlobalModalPageContent(this.editFavoritesPageTitle,{name:"jraf/favorites/EditFavoritesPage",params:{hidePinnedFavorites:this.hidePinnedFavorites,favoriteHandlerKey:this.favoriteHandlerKey}})},v.prototype.yd=function(t,i){var a=this.lastDrilledNode().guid;e("#"+this.favoritesNavListId).ojNavigationList("collapse",a,!0)},v.prototype.rb=function(){var e=this;this.ub=i.pureComputed((function(){var e=[],t=this.gd();return 0<t.length&&this.lb(e,t),e}),this),this.autosuggestSearch=function(t){return n.isString(t.term)?e.cb(t.term):Promise.resolve([])},this.handleAutosuggestSelect=function(t,i){e.vb(t)}},v.prototype.lb=function(e,t,a){for(var r=a?this.av.getLocalizedTitle(a.entryId):"",o=""!==r,s=0;s<t.length;s++){var n=t[s];n.isFolder?this.lb(e,n.children(),n):e.push({value:""+n.entryId,label:i.unwrap(this.av.getLocalizedTitle(n.entryId)),path:r,pathAvailable:o})}},v.prototype.cb=function(e){var t=this.ub().filter((function(t){var a=e.toLowerCase(),r=i.unwrap(t.label).toLowerCase(),o=i.unwrap(t.path).toLowerCase();return 0<=r.indexOf(a)||0<=o.indexOf(a)}));return 0===t.length&&t.push({label:this.noResultsText,pathAvailable:!1}),Promise.resolve(t)},v.prototype.vb=function(e){var t=e.target.value;return t&&(this.Rg(Number(t)),this.searchString.pop()),!0},v.prototype.ab=function(){var e=this;this.hasFolders=this.Al.getHasFoldersObservable(),this.flatListToggle=i.observableArray([]),this.flatListEnabled=i.pureComputed((function(){return 0<e.flatListToggle().length})),this.flatListToggleLabel=i.pureComputed((function(){return this.flatListEnabled()?this.toggleGroupViewLabel:this.toggleFlatListViewLabel}),this)},v}));