define(["ojs/ojcore","jquery","jraf/utils/UrlUtils","jraf/utils/ValidationUtils","jraf/services/AbstractService"],(function(e,t,r,a,i){"use strict";function o(e,t){o.superclass.constructor.apply(this,arguments),a.isObjectStrict(t)?(this.appCode=t.appCode,this.Sc=t.clientAppCode):this.appCode=t,this.appCodeUriString=encodeURIComponent(this.appCode)}return o.SERVICE_URL_PATH="services/private/Favorites",o.SERVICE_VERSION_OVERRIDE=null,o.REF_ITEM_ID_PREFIX="JRAF|",e.Object.createSubclass(o,i,"FavoritesService"),o.prototype.getServiceConfiguration=function(){return{baseUri:this.getBaseUri(),appCode:this.appCode}},o.prototype.GetStandardHeaders=function(){var e=o.superclass.GetStandardHeaders.apply(this);return e["Accept-Version"]=o.SERVICE_VERSION_OVERRIDE||e["Accept-Version"],e},o.prototype.td=function(e){var t=this.BuildEndpoint(e,o.SERVICE_URL_PATH);return this.Sc&&(t=r.injectQueryParameter(t,"clientAppCode",this.Sc)),t},o.prototype.loadFavorites=function(){var e=this,r=this.td("/fetch?appCode="+this.appCodeUriString),a=t.ajax(r,{headers:e.GetStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0}});return this.ConvertAjaxPromise(a).then((function(t){return e.ParseFavorites(t.favorites)}))},o.prototype.getSeededFavoritesCount=function(){var e=this.td("/Defaults?appCode="+this.appCodeUriString),r=t.ajax(e,{headers:this.GetStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0}});return this.ConvertAjaxPromise(r).then((function(e){return e.seededFavoritesCount}))},o.prototype.importSeededFavorites=function(){var e=this.td("/Defaults?appCode="+this.appCodeUriString),r=t.ajax(e,{headers:this.GetStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0},method:"POST"});return this.ConvertAjaxPromise(r)},o.prototype.addFavorite=function(e,r,a,i,o){var n=this.td("/add"),s=o?JSON.stringify(o):null,d={applicationCode:this.appCode,refItemId:this.GetRefItemId(e,r,i),favoriteType:a,objectId:i,favoriteContext:s},p=t.ajax(n,{headers:this.GetStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0},data:JSON.stringify(d),processData:!1,method:"POST"});return this.ConvertAjaxPromise(p)},o.prototype.deleteFavorite=function(e){var r=this.td("/delete"),a={favItemId:e},i=t.ajax(r,{headers:this.GetStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0},data:JSON.stringify(a),processData:!1,method:"DELETE"});return this.ConvertAjaxPromise(i)},o.prototype.updateFavorites=function(e){for(var r=this.td("/update"),a=[],i=0;i<e.length;i++)a.push({favItemId:e[i].favItemId,sequenceNumber:e[i].sequenceNumber,localPinSequenceNumber:e[i].localPinSequenceNumber,globalPinSequenceNumber:e[i].globalPinSequenceNumber,customName:e[i].customName,parentFavItemId:e[i].parentFavItemId,applicationCode:this.appCode});var o=t.ajax(r,{headers:this.GetStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0},data:JSON.stringify({favorites:a}),processData:!1,method:"POST"});return this.ConvertAjaxPromise(o)},o.prototype.replaceFavorites=function(e){var r=this.td("/replace"),a=this.ed(e),i=t.ajax(r,{headers:this.GetStandardHeaders(),dataType:"json",xhrFields:{withCredentials:!0},data:JSON.stringify({favorites:a}),processData:!1,method:"POST"});return this.ConvertAjaxPromise(i)},o.prototype.ed=function(e){return e.map((function(e){var t=e.favoriteContext,r=t?JSON.stringify(t):null,a={refItemId:this.GetRefItemId(e.refItemId,e.title,e.objectId),favoriteType:e.favoriteType,objectId:e.objectId,favoriteContext:r,seededFavItemId:e.seededFavItemId,localPinSequenceNumber:e.localPinSequenceNumber,globalPinSequenceNumber:e.globalPinSequenceNumber,customName:e.customName,applicationCode:this.appCode};return"folder"===e.favoriteType&&(a.children=this.ed(e.children)),a}),this)},o.prototype.GetRefItemId=function(e,t,r){return o.REF_ITEM_ID_PREFIX+e+"|"+t+(a.isNonemptyString(r)?"|"+r:"")},o.prototype.ParseFavorites=function(r){return a.isArray(r)?r.map((function(r){var a,i=this.GetFavoriteContentProperties(r);try{a=r.favoriteContext?JSON.parse(r.favoriteContext):null}catch(a){e.Logger.info("FavoritesService.ParseFavorites: could not parse favoriteContext for favorite id: "+r.favItemId)}var o="folder"===r.favoriteType?this.ParseFavorites(r.children):void 0;return t.extend({},r,{refItemId:i.refItemId,title:i.title,favoriteContext:a,children:o})}),this):[]},o.prototype.GetFavoriteContentProperties=function(e){var t=e.refItemId;if(!this.id(t))return{refItemId:t};var r=o.REF_ITEM_ID_PREFIX.length,a=t.indexOf("|",r),i=t.indexOf("|",a+1),n=t.substring(a+1);return 0<i&&a!==i&&(n=n.split("|")[0]),{refItemId:t.substring(r,a),title:n}},o.prototype.id=function(e){var t=o.REF_ITEM_ID_PREFIX.length;return a.isNonemptyString(e)&&0===e.indexOf(o.REF_ITEM_ID_PREFIX)&&e.indexOf("|",t)>t},o}));