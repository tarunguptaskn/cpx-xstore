define(["knockout","jquery","ojs/ojlogger","jraf/utils/ValidationUtils","jraf/composites/utils/TranslationLoaderUtil","module","ojs/ojtoolbar","ojs/ojbutton","ojs/ojmenu","ojs/ojconveyorbelt"],(function(t,n,i,o,e,a){"use strict";function s(t){var n=this,i=t.uniqueId;this._menuIdBase=i+"_menu",this._menuCounter=1,this._menuOptionsMap={},this._buttonsMap={},this.panelBarItems=[],this._buttonCounter=1,this._buttonIdBase=i+"_button",this.loadingTranslations=s._translationLoader.getTranslations(),this.handleMenuOptionSelect=function(t){n._handleMenuOptionSelect(t)},this.handleButtonClick=function(t){n._handleButtonClick(t)},this.componentInitializing=Promise.all([this.loadingTranslations,t.properties,t.slotCounts]).then((function(t){n.translations=t[0],n._initializeProperties(t[1]),n._initializeSlot(t[2]),n._initializeDividers(),n._initializePanelBarItems()}))}return s.SUPPORTED_CHROME=["solid","borderless","outlined","full","half"],s.DEFAULT_CHROME="solid",s.SUPPORTED_BUTTON_SIZES={small:"oj-button-sm",large:"oj-button-lg",xl:"oj-button-xl"},s.NAVIGATION_ICON_NEXT="oj-rgbu-jraf-apps-panel-bar-icon oj-rgbu-jraf-apps-panel-bar-next-icon",s.NAVIGATION_ICON_PREV="oj-rgbu-jraf-apps-panel-bar-icon oj-rgbu-jraf-apps-panel-bar-prev-icon",s._translationLoader=new e("oj-rgbu-jraf-apps-panel-bar",a.id),s.prototype.activated=function(){return this.componentInitializing},s.prototype.bindingsApplied=function(){this._scrollToMainButton()},s.prototype._initializeProperties=function(n){this.buttonSize=this._getButtonSize(n.buttonSize),this._mainActionChroming=this._getChromingValue(n.mainActionChroming),this.mainActionButtons=this._parseButtons(n.mainActionButtons,this._mainActionChroming),this.mainActionButtons.length>0&&!this.mainActionButtons[0].isMenu&&(this.mainActionButtons[0].chrome="callToAction"),this._navigationChroming=this._getChromingValue(n.navigationChroming),this.nextButton=null,this.prevButton=null,o.isFunction(n.nextCallback)&&(this.nextButton=this._parseButton({label:this.translations.nextLabel,callback:n.nextCallback,iconOnly:n.navigationIconOnly,icon:s.NAVIGATION_ICON_NEXT,disabled:t.observable(n.nextDisabled),shortcut:n.nextShortcut},this._navigationChroming),this.nextButton&&(this.nextButton.iconEnd=!0)),o.isFunction(n.prevCallback)&&(this.prevButton=this._parseButton({label:this.translations.previousLabel,callback:n.prevCallback,iconOnly:n.navigationIconOnly,icon:s.NAVIGATION_ICON_PREV,disabled:t.observable(n.prevDisabled),shortcut:n.prevShortcut},this._navigationChroming)),this._extraActionChroming=this._getChromingValue(n.extraActionChroming),this.extraActionButtons=this._parseButtons(n.extraActionButtons,this._extraActionChroming)},s.prototype._parseButtons=function(t,n){var i=[];if(!o.isArray(t))return i;for(var e=0;e<t.length;e++){var a=t[e],s=null;(s=o.isArray(a.options)?this._parseMenuButton(a,n):this._parseButton(a,n))&&i.push(s)}return i},s.prototype._parseButton=function(t,n){if(!o.isObjectStrict(t)||!o.isFunction(t.callback))return i.warn("AppsPanelBar._parseButton: Missing required parameters for button"),null;var e=this._parseButtonCore(t,n);return e.isMenu=!1,e.isSeparator=!1,e.callback=t.callback,this._buttonsMap[e.id]=e,e},s.prototype._parseMenuButton=function(t,n){if(!o.isObjectStrict(t)||!o.isArray(t.options)||0===t.options.length)return i.warn("AppsPanelBar._parseMenuButton: Menu has no options"),null;var e=this._parseButtonCore(t,n);return e.isMenu=!0,e.isSeparator=!1,e.menuId=this._menuIdBase+this._menuCounter,e.options=this._parseMenuOptions(t.options,e.menuId),this._menuCounter++,e},s.prototype._parseButtonCore=function(n,e){var a=o.getBoolean(n.iconOnly,!1),s=o.isNonemptyString(n.icon)?n.icon:null,r=!o.isBoolean(t.unwrap(n.displayed))||n.displayed;return!t.isObservable(n.label)&&!o.isNonemptyString(n.label)||a&&!s?(i.warn("AppsPanelBar._parseButtonCore: Missing required parameters for button"),null):{id:this._buttonIdBase+"-"+this._buttonCounter++,label:n.label,icon:s,display:a?"icons":"all",displayed:r,disabled:n.disabled,shortcut:this._getButtonShortcut(n.shortcut),chrome:e,size:this.buttonSize}},s.prototype._parseMenuOptions=function(n,e){for(var a=[],s=0;s<n.length;s++){var r=n[s],l=!o.isBoolean(t.unwrap(r.displayed))||r.displayed;if((t.isObservable(r.label)||o.isNonemptyString(r.label))&&o.isFunction(r.callback)){var u={label:r.label,icon:r.icon,callback:r.callback,disabled:r.disabled,displayed:l,optionId:e+"-"+s};a.push(u),this._menuOptionsMap[u.optionId]=u}else i.warn("AppsPanelBar._parseMenuOptions: Missing required parameters for menu option")}return a},s.prototype._getChromingValue=function(t){return s.SUPPORTED_CHROME.indexOf(t)<0?(i.warn("AppsPanelBar._getChromingValue: Invalid chrome "+t),s.DEFAULT_CHROME):t},s.prototype._getButtonSize=function(t){var n=s.SUPPORTED_BUTTON_SIZES[t];return n||""},s.prototype._getButtonShortcut=function(t){return!o.isNonemptyString(t)||t.length>1?null:t},s.prototype._initializeSlot=function(t){this._hasCustomContent=!!t.customContent},s.prototype._initializeDividers=function(){var t=this.mainActionButtons.length>0,n=this.prevButton||this.nextButton,i=this.extraActionButtons.length>0;this.showNavDivider=t&&n,this.showExtraDivider=(t||n)&&i,this.showSlotDivider=(t||n||i)&&this._hasCustomContent},s.prototype._initializePanelBarItems=function(){this.panelBarItems=this.panelBarItems.concat(this.mainActionButtons),this.showNavDivider&&this.panelBarItems.push({isSeparator:!0}),this.nextButton&&(this.panelBarItems=this.panelBarItems.concat(this.nextButton)),this.prevButton&&(this.panelBarItems=this.panelBarItems.concat(this.prevButton)),this.showExtraDivider&&this.panelBarItems.push({isSeparator:!0}),this.panelBarItems=this.panelBarItems.concat(this.extraActionButtons),this.showSlotDivider&&this.panelBarItems.push({isSeparator:!0})},s.prototype._handleMenuOptionSelect=function(t){var n=t.target.id,i=this._menuOptionsMap[n];i.callback(i,t)},s.prototype._handleButtonClick=function(t){var n=t.target.id,i=this._buttonsMap[n];i.callback(i,t)},s.prototype._scrollToMainButton=function(){var n=this.mainActionButtons[0];n&&t.unwrap(n.displayed)&&document.getElementById(n.id).scrollIntoView()},s.prototype.propertyChanged=function(t){var n=t.property;"external"===t.updatedFrom&&("nextDisabled"===n&&this.nextButton?this.nextButton.disabled(t.value):"prevDisabled"===n&&this.prevButton&&this.prevButton.disabled(t.value))},s}));