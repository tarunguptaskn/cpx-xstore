define(["knockout","ojs/ojlogger","ojs/ojresponsiveutils","ojs/ojresponsiveknockoututils","ojs/ojoffcanvas","jraf/composites/utils/TranslationLoaderUtil","module","ojs/ojtoolbar","ojs/ojbutton","ojs/ojoffcanvas","ojs/ojknockout"],(function(t,e,n,o,i,s,a){"use strict";function l(t){var n=this;this._loadingTranslations=l._translationLoader.getTranslations(),this._initializeProperties(t),this._componentInitializing=this._loadingTranslations.then((function(t){n._initializeTranslations(t),e.info("oj-rgbu-jraf-content-frame: component initialized.")}))}return l.CHANGEABLE_PROPERTIES={"additionalInfo.disabled":"additionalInfoDisabled","contextualHelp.disabled":"contextualHelpDisabled"},l._translationLoader=new s("oj-rgbu-jraf-content-frame",a.id),l.prototype.activated=function(){return this._componentInitializing},l.prototype.bindingsApplied=function(){var n=this;e.info("oj-rgbu-jraf-content-frame.bindingsApplied: Subscribing to custom button state changes."),this._customButtonChangeSubscriptions=[],this.renderCustomButtons&&this.customButtons.forEach((function(e){t.isSubscribable(e.disabled)&&n._customButtonChangeSubscriptions.push(e.disabled.subscribe((function(){this._refreshToolbar()}),n)),t.isSubscribable(e.label)&&n._customButtonChangeSubscriptions.push(e.label.subscribe((function(){this._refreshToolbar()}),n))}))},l.prototype.disconnected=function(){e.info("oj-rgbu-jraf-content-frame.disconnected: Disposing subscriptions to custom button states."),this._customButtonChangeSubscriptions.forEach((function(t){t.dispose()}))},l.prototype._initializeProperties=function(e){var i=this,s=e.properties,a=e.uniqueId;this.toolbarId=a+"_toolbar",this.customButtonsSetId=a+"_customButtonsSet",this.defaultButtonsSetId=a+"_defaultButtonsSet",this.mainContentId=a+"_mainContent",this.contentFrameDrawerId=a+"_contentFrameDrawer",this._loadedPanels=[],this.activePanel=t.observable(),this.isPanelActive=t.observable(!1),this.selectedPanelTitle=t.observable(),this.panelLoading=t.observable(!1),this.panelOpen=t.observable(!1);var l=o.createScreenRangeObservable();this.isSmallScreen=t.pureComputed((function(){return l()===n.SCREEN_RANGE.SM})),this.showModalOverlay=t.pureComputed((function(){return this.panelOpen()&&this.isSmallScreen()}),this),this.compactMainContent=t.pureComputed((function(){return this.panelOpen()&&!this.isSmallScreen()}),this),this.headerTitle=s.header,this.customButtons=s.customButtons,this._customButtonCount=Array.isArray(this.customButtons)?this.customButtons.length:0,this.renderCustomButtons=this._customButtonCount>0,this._additionalInfoLabel=t.observable(s.additionalInfo.label),this.additionalInfoDisabled=t.observable(s.additionalInfo.disabled),this._contextualHelpLabel=t.observable(s.contextualHelp.label),this.contextualHelpDisabled=t.observable(s.contextualHelp.disabled),this.compact=t.observable(s.compact),this.renderSeparator=this.renderCustomButtons&&(s.additionalInfo.displayed||s.contextualHelp.displayed),this.contextualAreaCount=e.slotCounts.contextualArea,this.isContextualPanelRendered=function(t){return i._isContextualPanelRendered(t)},this.closePanel=function(){i._closePanel()},this.handleCustomButtonChange=function(t){i._handleButtonChange(t,!0)},this.handleDefaultButtonChange=function(t){i._handleButtonChange(t,!1)},this.getButtonIconClass=function(t){return i._getButtonIconClass(t)},this._initializePanels(s),this._monitorPanelSelection()},l.prototype._initializeTranslations=function(t){this.toolbarLabel=this.headerTitle+" "+t.toolbarLabel,this._additionalInfoLabel(this._additionalInfoLabel()||t.additionalInfoLabel),this._contextualHelpLabel(this._contextualHelpLabel()||t.contextualHelpLabel),this.closeLabel=t.closeLabel},l.prototype._initializePanels=function(t){this.defaultButtons=[],t.additionalInfo.displayed&&this.defaultButtons.push({label:this._additionalInfoLabel,disabled:this.additionalInfoDisabled,iconClass:"oj-rgbu-jraf-content-frame-additional-info-icon"}),t.contextualHelp.displayed&&this.defaultButtons.push({label:this._contextualHelpLabel,disabled:this.contextualHelpDisabled,iconClass:"oj-rgbu-jraf-content-frame-help-icon"}),this._panelConfigMap={};var e=this.customButtons;if(this.renderCustomButtons)for(var n=0;n<this._customButtonCount;n++){var o=e[n];this._panelConfigMap[n]=o}for(var i=this._customButtonCount,s=0;i<this._customButtonCount+this.defaultButtons.length;i++,s++){var a=this.defaultButtons[s];this._panelConfigMap[i]=a}this._panelAnimating=Promise.resolve()},l.prototype._monitorPanelSelection=function(){this.selectedCustomButton=t.observableArray([]),this.selectedDefaultButton=t.observableArray([]),this.selectedCustomButton.subscribe((function(t){1===t.length&&this.selectedDefaultButton([])}),this),this.selectedDefaultButton.subscribe((function(t){1===t.length&&this.selectedCustomButton([])}),this)},l.prototype._handleButtonChange=function(t,e){var n=t.detail.previousValue,o=t.detail.value,i=e?this.selectedCustomButton:this.selectedDefaultButton,s=e?this.selectedDefaultButton:this.selectedCustomButton;if(Array.isArray(n)&&1===n.length&&o.length>1){var a=n[0];i(o.filter((function(t){return t!==a})))}else 0!==o.length||0!==s().length?0!==o.length&&this._updatePanelState(e?this.selectedCustomButton()[0]:this._getDefaultButtonIndex()):this.closeContextualArea()},l.prototype._getDefaultButtonIndex=function(){return this.selectedDefaultButton()[0]+this._customButtonCount},l.prototype._getButtonIconClass=function(e){return t.pureComputed((function(){var n=e.jrafAppliedButtonIconClass||{};Object.keys(n).forEach((function(t){n[t]=!1}));var o=t.unwrap(e.iconClass);return o&&"string"==typeof o&&(n[o]=!0),e.jrafAppliedButtonIconClass=n,n}))},l.prototype._updatePanelState=function(n){e.info("oj-rgbu-jraf-content-frame: displaying panel %d",n);var o=t.unwrap(this._panelConfigMap[n].label);this.selectedPanelTitle(o),this._setActivePanel(n),this.panelOpen()||this._openPanel()},l.prototype._setActivePanel=function(t){this.activePanel(t),this.isPanelActive(!0)},l.prototype._openPanel=function(){var t=this;this._panelAnimating=this._panelAnimating.then((function(){return t.panelOpen(!0),i.open({selector:"#"+t.contentFrameDrawerId,displayMode:"overlay",autoDismiss:"none"})}))},l.prototype._closePanel=function(){var t=this;this._panelAnimating=this._panelAnimating.then((function(){return t.panelOpen(!1),i.close({selector:"#"+t.contentFrameDrawerId})})),this.selectedCustomButton([]),this.selectedDefaultButton([])},l.prototype._isContextualPanelRendered=function(t){return t===this.activePanel()},l.prototype.openContextualArea=function(t){if("number"!=typeof t||t<0||t>=this._customButtonCount+this.defaultButtons.length)throw new TypeError("oj-rgbu-jraf-content-frame.openContextualArea: panelIndex is out of range");t<this._customButtonCount?this.selectedCustomButton([t]):this.selectedDefaultButton([t-this._customButtonCount])},l.prototype.closeContextualArea=function(){this.panelOpen()&&this._closePanel()},l.prototype.propertyChanged=function(t){var e=t.property;if("external"===t.updatedFrom){if("additionalInfo"===e||"contextualHelp"===e){var n=t.subproperty.path;this[l.CHANGEABLE_PROPERTIES[n]](t.subproperty.value),this._refreshToolbar()}"compact"===e&&this[e](t.value)}},l.prototype._refreshToolbar=function(){document.getElementById(this.toolbarId).refresh()},l}));