define(["ojs/ojcore","knockout","jquery","jraf/jrafcore","jraf/models/UIShellManager","libs/xenvironment/urlService","ojs/ojmodule-element-utils","ojs/ojmodule-element","ojs/ojmodel","jraf/composites/oj-rgbu-jraf-simple-grid/loader","ojs/ojcomposite","jraf/composites/oj-rgbu-jraf-snackbar/loader"],(function(e,t,n,i,l,a,r){let o=e.Translations.getTranslatedString;var s=[{valueName:"attribute",width:"45%",cellAlignment:"start"},{valueName:"value",width:"54.95%",cellAlignment:"start",cellClassNameFunction:function(e){return"Active"===e.data?"xenv-device-detail-active-icon":"Inactive"===e.data?"xenv-device-detail-inactive-icon":void 0}}],d=["registerIp","regNum","businessDate","onlineType","registerOpen","lastUpdated","environmentVersion"];return function(c){let u=this;u.deviceNumber=c.deviceNumber,u.deviceNumberText=o("xenv.device.regNum")+" "+u.deviceNumber,u.deviceType=c.deviceType,u.viewToggleButtonId=i.UIShell.generateUniqueId(),u.statusAreaId=i.UIShell.generateUniqueId(),u.appControlAreaId=i.UIShell.generateUniqueId(),u.detailSnackbarId=i.UIShell.generateUniqueId(),u.errContainerId=i.UIShell.generateUniqueId(),u.isXenvMachine=t.observable(!1),u.toggleButtonLabel=t.observable(o("xenv.device.appControlLabel")),u.columnSettings=s,u.collection=t.observable(),u.statusConfig=r.createConfig({name:"status",params:{deviceNumber:u.deviceNumber}}),u.appControlConfig=r.createConfig({name:"startstop",params:{deviceNumber:u.deviceNumber,detailSnackbarId:u.detailSnackbarId}});let v=[];"MOBILE"!==u.deviceType&&u.isXenvMachine(!0),u.toggleView=function(e){console.info("Toggle View Pressed");let t=document.getElementById(u.statusAreaId),n=document.getElementById(u.appControlAreaId);"none"===t.style.display?(t.style.display="block",n.style.display="none",u.toggleButtonLabel(o("xenv.device.appControlLabel"))):(t.style.display="none",n.style.display="block",u.toggleButtonLabel(o("xenv.device.systemStatusLabel")))},u.getAttributeValue=function(e,t){return"onlineType"==e?o("xenv.general."+t[e]):"registerOpen"==e?t[e]?o("xenv.general.Open"):o("xenv.general.Closed"):"lastUpdated"==e?void 0===t[e]?"":t[e]:"businessDate"==e&&void 0===t[e]?"":t[e]},u.retrieveDeviceDetail=function(){let t=document.getElementById(u.errContainerId);l.startProcessingIndicator();let i=n.ajax(a.getDevicesServiceUrl(u.deviceNumber),{type:"GET",dataType:"json",xhrFields:{withCredentials:!0}});i.done((function(n){null!==t&&(t.style.display="none");let i,a=[];for(i in d){let e="";(u.isXenvMachine()||"registerIp"!==d[i]&&"environmentVersion"!==d[i])&&(e="lastUpdated"===d[i]?u.getAttributeValue("lastUpdatedStr",n):u.getAttributeValue(d[i],n),a.push({attribute:o("xenv.device."+d[i]),value:e}))}v.toString()!==a.toString()&&(u.collection(new e.Collection(a)),v=a),l.stopProcessingIndicator()})),i.fail((function(e,n,i){console.error("Could not get Device Information: "+i),null!==t&&(t.innerHTML=o("xenv.device.noComms",u.deviceNumber),t.style.display="block"),l.stopProcessingIndicator()}))},u.retrieveDeviceDetail(),i.UIShell.registerPollingId(setInterval(u.retrieveDeviceDetail,5e3))}}));