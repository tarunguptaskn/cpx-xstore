define(["jquery","ojs/ojcore","knockout","jraf/jrafcore","jraf/models/favorites/FavoritesContent","jraf/models/favorites/FavoritesConfig","jraf/models/UIShellManager","jraf/utils/ValidationUtils","jraf/models/Content","ojs/ojmodule-element-utils","ojs/ojbutton","ojs/ojmodule-element"],(function(e,t,i,a,o,r,n,s,d,l){"use strict";var v=t.Translations.getTranslatedString;function h(e){var t=this;this.favoriteHandlerKey=e?e.favoriteHandlerKey:void 0,this.hidePinnedFavorites=s.getBoolean(e.hidePinnedFavorites,!1),this.hideEditFavorites=s.getBoolean(e.hideEditFavorites,!1),this.favoritesNavListId=a.UIShell.generateUniqueId(),this.editFavoritesButtonLabel=v("jraf.sidebar.favorites.editFavoritesLabel"),this.defaultEditFavoritesPageTitle=v("jraf.sidebar.favorites.editFavoritesPageTitle"),this.editFavoritesPageTitle=e.editFavoritesPageTitle||this.defaultEditFavoritesPageTitle,this.loadingText=v("jraf.messages.loading"),this._favoriteHandler=r.getInstance().getFavoriteHandler(this.favoriteHandlerKey),this._favoritesContent=o.getInstance(this._favoriteHandler.getFavoritesService(),this.favoriteHandlerKey),this._favorites=this._favoritesContent.getFavorites();var n=i.observable(!1);this.menuDataLoaded=i.pureComputed((function(){return n()})),this.drilledPath=i.observableArray([]),this.isHierarchyRoot=i.pureComputed((function(){return t.drilledPath().length<1})),this.lastDrilledNode=i.pureComputed((function(){return t.isHierarchyRoot()?null:t.drilledPath()[t.drilledPath().length-1]})),this.drilledNodeLabel=i.pureComputed((function(){return t.isHierarchyRoot()?"":t._getLocalizedTitle(t.lastDrilledNode().favorite.entryId)()}));var d={name:"jraf/favorites/FavoritesMenuBody",params:{favoritesNavListId:this.favoritesNavListId,menuDataLoaded:n,favoriteHandlerKey:this.favoriteHandlerKey,hidePinnedFavorites:this.hidePinnedFavorites,drilledPath:this.drilledPath,openContentCallback:function(e){t._openContent(e)}}};this.favoritesBodyModuleConfig=l.createConfig(d),this.editFavorites=function(){t._handleEditFavorites()},this.navigateUpHierarchy=function(){t._handleNavigateUpHierarchy()}}return h.prototype._getLocalizedTitle=function(e){return this._favoriteHandler.getLocalizedTitle(e)},h.prototype._openContent=function(e){n.closePopupMenu(),this._favoriteHandler.openContent(e)},h.prototype._handleEditFavorites=function(){n.closePopupMenu(),n.openContent(this._getEditFavoritesPageContent()),this.isHierarchyRoot()||this.navigateUpHierarchy()},h.prototype._getEditFavoritesPageContent=function(){return d.createModuleGlobalModalPageContent(this.editFavoritesPageTitle,{name:"jraf/favorites/EditFavoritesPage",params:{hidePinnedFavorites:this.hidePinnedFavorites,favoriteHandlerKey:this.favoriteHandlerKey}})},h.prototype._handleNavigateUpHierarchy=function(t,i){var a=this.lastDrilledNode().guid;e("#"+this.favoritesNavListId).ojNavigationList("collapse",a,!0)},h}));