define(["jquery","ojs/ojcore","knockout","jraf/jrafcore","jraf/models/UIShellManager","libs/xenvironment/urlService","ojs/ojknockout","ojs/ojcomposite","jraf/composites/oj-rgbu-jraf-snackbar/loader"],(function(e,t,n,r,o,a){let s=t.Translations.getTranslatedString;return function(t){let i=this;i.headerLabel=s("xenv.startstop.HeaderLabel"),i.runningLabel=s("xenv.startstop.Running"),i.stoppedLabel=s("xenv.startstop.Stopped"),i.startLabel=s("xenv.startstop.Start"),i.stopLabel=s("xenv.startstop.Stop"),i.deviceNumber=t.deviceNumber,i.detailSnackbarId=t.detailSnackbarId,i.controlIdPrefix=r.UIShell.generateUniqueId(),i.controlSnackbarId=r.UIShell.generateUniqueId(),i.startStopFunctions=n.observableArray();let c=new Map;i.retrieveMenuItems=function(){let t=e.ajax(a.getAppControlServiceUrl(i.deviceNumber),{type:"GET",dataType:"json",xhrFields:{withCredentials:!0}});t.done((function(e){let t=!0;e.forEach((e,n)=>{e.startActionId=i.controlIdPrefix+e.startAction,e.stopActionId=i.controlIdPrefix+e.stopAction,0!==c.size&&c.get(e.appName)===e.running||(t=!1,c.set(e.appName,e.running))}),t||(console.debug("Start-Stop Menu options are : "+JSON.stringify(e)),i.startStopFunctions(e))})),t.fail((function(e,t,n){console.error("Could not get menu items: "+n),c.clear()}))},i.retrieveMenuItems(),r.UIShell.registerPollingId(setInterval(i.retrieveMenuItems,5e3)),i.doStartStop=function(t){console.debug("Disabling button"),document.getElementById(t.currentTarget.id).setAttribute("disabled","true"),o.startProcessingIndicator();let n=t.currentTarget.id.substring(i.controlIdPrefix.length);console.debug("Requesting action :"+n),e.ajax(a.getAppControlServiceUrl(i.deviceNumber),{type:"POST",dataType:"json",data:{name:n},xhrFields:{withCredentials:!0},crossDomain:!0,complete:i.callComplete(t.currentTarget.id)}).done((function(e){"ERROR"===e.actionState?i.showSnackBar(e.message,"error",5e3):"WARNING"===e.actionState||"DISABLED"===e.actionState?i.showSnackBar(e.message,"warning",5e3):i.showSnackBar(e.message,"success")})).fail((function(e,t,n){e.hasOwnProperty("responseJSON")?i.showSnackBar(e.responseJSON.message,"error"):i.showSnackBar(n,"error")}))},i.callComplete=function(e){console.debug("Re-enabling button "+e),document.getElementById(e).setAttribute("disabled","false"),o.stopProcessingIndicator()},i.showSnackBar=function(e,t,n){null===n&&(n=2e3);let r="";r=i.deviceNumber?i.detailSnackbarId:i.controlSnackbarId,console.info("Action result: "+e+" on snackbarId :"+r),document.getElementById(r).openSnack({message:e,severity:t,timeout:n})}}}));